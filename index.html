<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Master Suite</title>

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Lucide Icons (Vanilla for easy integration) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans KR"', 'sans-serif'],
                        mono: ['"Roboto Mono"', 'monospace'],
                    },
                    colors: {
                        navy: { 900: '#0f172a', 800: '#1e293b' },
                        royal: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
                        bronze: { 50: '#fffbeb', 100: '#fef3c7', 500: '#f59e0b', 600: '#d97706', 700: '#b45309' }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    
        /* Password overlay */
        .lock-wrap {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(2, 6, 23, 0.75);
            backdrop-filter: blur(10px);
            z-index: 9999;
            padding: 20px;
        }

        .lock-card {
            width: 100%;
            max-width: 420px;
            background: white;
            border-radius: 24px;
            padding: 22px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(226, 232, 240, 1);
            font-family: "Noto Sans KR", sans-serif;
        }

        .lock-title {
            font-size: 18px;
            font-weight: 900;
            color: #0f172a;
            margin-bottom: 6px;
        }

        .lock-sub {
            font-size: 13px;
            color: #64748b;
            line-height: 1.5;
            margin-bottom: 14px;
        }

        .lock-row {
            display: flex;
            gap: 10px;
        }

        .lock-input {
            flex: 1;
            padding: 12px 14px;
            border: 1px solid #e2e8f0;
            border-radius: 14px;
            font-size: 14px;
            outline: none;
        }

        .lock-input:focus {
            border-color: #0f172a;
        }

        .lock-btn {
            padding: 12px 14px;
            border: 0;
            border-radius: 14px;
            font-size: 14px;
            font-weight: 800;
            cursor: pointer;
            background: #0f172a;
            color: #fff;
            white-space: nowrap;
        }

        .lock-err {
            display: none;
            margin-top: 10px;
            font-size: 13px;
            color: #dc2626;
            font-weight: 700;
        }

        .lock-hint {
            margin-top: 10px;
            font-size: 11px;
            color: #94a3b8;
        }

    </style>
</head>

<body class="bg-slate-50 text-slate-800 font-sans antialiased h-screen flex overflow-hidden">
    <div id="root" class="w-full h-full"></div>

    

    <!-- ✅ 비밀번호 오버레이 (간단 구현) -->
    <div id="lock" class="lock-wrap" aria-modal="true" role="dialog">
        <div class="lock-card">
            <div class="lock-title">접근 비밀번호</div>
            <div class="lock-sub">이 페이지는 비밀번호를 입력해야 확인할 수 있습니다.</div>

            <div class="lock-row">
                <input id="lockPw" class="lock-input" type="password" placeholder="비밀번호 입력" autocomplete="off" />
                <button id="lockBtn" class="lock-btn">확인</button>
            </div>

            <div id="lockErr" class="lock-err">비밀번호가 일치하지 않습니다.</div>
            <div class="lock-hint">※ 간단 보호(소스 보기로 우회 가능) 방식입니다.</div>
        </div>
    </div>

    <script>
        // =========================
        // ✅ 여기 비밀번호만 바꾸세요
        // =========================
        const PASSWORD = "theone2026";

        // 인증 유지 방식: 탭/브라우저 닫으면 풀림(세션)
        const KEY = "FM_AUTHTOKEN";

        const lockEl = document.getElementById("lock");
        const pwEl = document.getElementById("lockPw");
        const btnEl = document.getElementById("lockBtn");
        const errEl = document.getElementById("lockErr");

        function isAuthed() {
            return sessionStorage.getItem(KEY) === "1";
        }
        function setAuthed() {
            sessionStorage.setItem(KEY, "1");
        }
        function hideLock() {
            lockEl.style.display = "none";
            errEl.style.display = "none";
            pwEl.value = "";
        }
        function showLock() {
            lockEl.style.display = "flex";
            errEl.style.display = "none";
            pwEl.value = "";
            setTimeout(() => pwEl.focus(), 50);
        }

        function checkPw() {
            if (pwEl.value === PASSWORD) {
                setAuthed();
                hideLock();
            } else {
                errEl.style.display = "block";
                pwEl.select();
            }
        }

        btnEl.addEventListener("click", checkPw);
        pwEl.addEventListener("keydown", (e) => {
            if (e.key === "Enter") checkPw();
        });

        // 최초 진입
        if (isAuthed()) hideLock();
        else showLock();
    </script>

<script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Icons Component Wrapper ---
        const Icon = ({ name, size = 20, className = "" }) => {
            const iRef = useRef(null);
            useEffect(() => {
                if (iRef.current) {
                    iRef.current.setAttribute('data-lucide', name);
                    lucide.createIcons({
                        root: iRef.current.parentNode,
                        nameAttr: 'data-lucide',
                        attrs: { width: size, height: size, class: className }
                    });
                }
            }, [name, size, className]);
            return <i ref={iRef} className={className}></i>;
        };

        // --- Utils ---
        const formatMoney = (n) => new Intl.NumberFormat('ko-KR').format(Math.round(n));
        const parseMoney = (s) => parseInt(s.replace(/[^0-9]/g, '')) || 0;

        // ==========================================
        // MODULE 1: Wealth Growth Simulator
        // ==========================================
        const WealthGrowth = () => {
            const [state, setState] = useState({
                age: 35, duration: 30, principal: 50000000, rateA: 3.5, rateB: 7.0
            });
            const [results, setResults] = useState([]);
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            const calculate = () => {
                const data = [];
                const { principal, rateA, rateB, duration, age } = state;
                for (let i = 1; i <= duration; i++) {
                    const totalA = principal * Math.pow((1 + rateA / 100), i);
                    const totalB = principal * Math.pow((1 + rateB / 100), i);
                    data.push({
                        year: i, currentAge: age + i, totalA, totalB,
                        accRateA: (totalA / principal) * 100,
                        accRateB: (totalB / principal) * 100,
                        diff: totalB - totalA
                    });
                }
                setResults(data);
            };

            useEffect(() => { calculate(); }, [state]);

            useEffect(() => {
                if (!chartRef.current || results.length === 0) return;
                const ctx = chartRef.current.getContext('2d');
                if (chartInstance.current) chartInstance.current.destroy();

                const gradA = ctx.createLinearGradient(0, 0, 0, 400);
                gradA.addColorStop(0, 'rgba(59, 130, 246, 0.2)'); gradA.addColorStop(1, 'rgba(59, 130, 246, 0.0)');
                const gradB = ctx.createLinearGradient(0, 0, 0, 400);
                gradB.addColorStop(0, 'rgba(217, 119, 6, 0.2)'); gradB.addColorStop(1, 'rgba(217, 119, 6, 0.0)');

                chartInstance.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: results.map(d => d.year + '년'),
                        datasets: [
                            { label: 'Plan A (보수적)', data: results.map(d => d.totalA), borderColor: '#2563eb', backgroundColor: gradA, fill: true, tension: 0.4, pointRadius: 0 },
                            { label: 'Plan B (적극적)', data: results.map(d => d.totalB), borderColor: '#d97706', backgroundColor: gradB, fill: true, tension: 0.4, pointRadius: 0 }
                        ]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false },
                        plugins: { legend: { display: false } },
                        scales: { x: { grid: { display: false } }, y: { position: 'right', grid: { borderDash: [4, 4] } } }
                    }
                });
                return () => { if (chartInstance.current) chartInstance.current.destroy(); };
            }, [results]);

            const final = results.length > 0 ? results[results.length - 1] : { totalA: 0, totalB: 0, accRateA: 0, accRateB: 0, diff: 0 };

            return (
                <div className="space-y-6 p-4 md:p-8 overflow-y-auto h-full custom-scroll pb-20">
                    <div className="bg-white rounded-3xl shadow-sm border border-slate-100 p-6">
                        <h2 className="text-lg font-bold text-navy-900 mb-4 flex items-center gap-2"><Icon name="sliders" size={20} /> 시뮬레이션 설정</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase">현재 나이</label>
                                <input type="number" value={state.age} onChange={e => setState({ ...state, age: Number(e.target.value) })} className="w-full border-b-2 border-slate-200 text-xl font-bold text-right focus:outline-none focus:border-navy-900 py-2 bg-transparent" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase">투자 기간 (년)</label>
                                <input type="number" value={state.duration} onChange={e => setState({ ...state, duration: Number(e.target.value) })} className="w-full border-b-2 border-slate-200 text-xl font-bold text-right focus:outline-none focus:border-navy-900 py-2 bg-transparent" />
                            </div>
                            <div className="lg:col-span-2">
                                <label className="text-xs font-bold text-slate-400 uppercase">투자 원금</label>
                                <input type="text" value={formatMoney(state.principal)} onChange={e => setState({ ...state, principal: parseMoney(e.target.value) })} className="w-full border-b-2 border-slate-200 text-xl font-bold text-right focus:outline-none focus:border-navy-900 py-2 bg-transparent font-mono" />
                            </div>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6 pt-6 border-t border-slate-100">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2 text-royal-600"><Icon name="shield" size={18} /> <span className="font-bold">Plan A (보수적)</span></div>
                                <div className="flex items-center gap-1"><input type="number" step="0.1" value={state.rateA} onChange={e => setState({ ...state, rateA: Number(e.target.value) })} className="w-16 text-right font-bold border-b border-royal-200 focus:outline-none text-lg text-royal-600" /><span>%</span></div>
                            </div>
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2 text-bronze-600"><Icon name="trending-up" size={18} /> <span className="font-bold">Plan B (적극적)</span></div>
                                <div className="flex items-center gap-1"><input type="number" step="0.1" value={state.rateB} onChange={e => setState({ ...state, rateB: Number(e.target.value) })} className="w-16 text-right font-bold border-b border-bronze-200 focus:outline-none text-lg text-bronze-600" /><span>%</span></div>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="bg-white rounded-3xl p-6 shadow-sm border border-royal-100 relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-24 h-24 bg-royal-50 rounded-full blur-2xl -translate-y-1/2 translate-x-1/2"></div>
                            <h3 className="text-sm font-bold text-slate-400 uppercase mb-1">Plan A Result</h3>
                            <p className="text-5xl font-black text-royal-600 font-mono tracking-tight">{formatMoney(final.totalA)}원</p>
                            <p className="text-xl text-royal-500 mt-2 font-bold">수익률 {final.accRateA.toFixed(0)}%</p>
                        </div>
                        <div className="bg-white rounded-3xl p-6 shadow-sm border border-bronze-100 relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-24 h-24 bg-bronze-50 rounded-full blur-2xl -translate-y-1/2 translate-x-1/2"></div>
                            <h3 className="text-sm font-bold text-slate-400 uppercase mb-1">Plan B Result</h3>
                            <p className="text-5xl font-black text-bronze-600 font-mono tracking-tight">{formatMoney(final.totalB)}원</p>
                            <p className="text-xl text-bronze-500 mt-2 font-bold">수익률 {final.accRateB.toFixed(0)}%</p>
                        </div>
                        <div className="bg-navy-900 rounded-3xl p-6 shadow-lg text-white flex flex-col justify-center relative overflow-hidden">
                            <h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">GAP ANALYSIS</h3>
                            <p className="text-4xl font-black font-mono tracking-tight">{formatMoney(Math.abs(final.diff))}</p>
                            <p className="text-sm text-slate-300 mt-2">이율 <span className="text-bronze-400 font-bold">{(state.rateB - state.rateA).toFixed(1)}%p</span> 차이의 결과</p>
                        </div>
                    </div>

                    <div className="bg-white rounded-3xl shadow-sm border border-slate-100 p-6">
                        <h3 className="text-lg font-bold text-navy-900 mb-4">자산 성장 추이</h3>
                        <div className="h-64 sm:h-80 w-full relative"><canvas ref={chartRef}></canvas></div>
                    </div>

                    <div className="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                        <div className="max-h-60 overflow-y-auto custom-scroll">
                            <table className="w-full text-right text-sm whitespace-nowrap">
                                <thead className="bg-slate-50 sticky top-0 text-xs text-slate-500 uppercase">
                                    <tr>
                                        <th className="py-3 px-4 text-center">Year/Age</th>
                                        <th className="py-3 px-4 text-royal-600">Plan A</th>
                                        <th className="py-3 px-4 text-bronze-600">Plan B</th>
                                        <th className="py-3 px-4 text-navy-900">Gap</th>
                                    </tr>
                                </thead>
                                <tbody className="font-mono text-slate-600 divide-y divide-slate-50">
                                    {results.map((d, i) => (
                                        <tr key={i} className="hover:bg-slate-50/50">
                                            <td className="py-3 px-4 text-center text-xs text-slate-400">{d.year}년후 <span className="ml-1 font-bold text-slate-600">{d.currentAge}세</span></td>
                                            <td className="py-3 px-4 text-royal-600">{formatMoney(d.totalA)}</td>
                                            <td className="py-3 px-4 text-bronze-600">{formatMoney(d.totalB)}</td>
                                            <td className="py-3 px-4 font-bold text-navy-900">+{formatMoney(d.diff)}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // MODULE 2: Financial Sales Master
        // ==========================================
        const SalesMaster = () => {
            const [activeTab, setActiveTab] = useState('compound');

            // Sub-Components for tabs
            const CompoundCalc = () => {
                const [vals, setVals] = useState({ age: 45, goal: '', save: 300000, rate: 5, years: 10 });
                const chartRef = useRef(null);
                const chartInstance = useRef(null);

                const data = useMemo(() => {
                    const res = [];
                    for (let i = 1; i <= vals.years; i++) {
                        const mRate = vals.rate / 100 / 12;
                        const months = i * 12;
                        const fv = vals.save * ((Math.pow(1 + mRate, months) - 1) / mRate);
                        const principal = vals.save * 12 * i;
                        res.push({ age: vals.age + i, principal: Math.round(principal), total: Math.round(fv), interest: Math.round(fv - principal) });
                    }
                    return res;
                }, [vals]);

                useEffect(() => {
                    if (!chartRef.current || data.length === 0) return;
                    const ctx = chartRef.current.getContext('2d');
                    if (chartInstance.current) chartInstance.current.destroy();

                    chartInstance.current = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.map(d => d.age + '세'),
                            datasets: [
                                { label: '원금', data: data.map(d => d.principal), backgroundColor: '#94a3b8', stack: 's1' },
                                { label: '이자', data: data.map(d => d.interest), backgroundColor: '#3b82f6', stack: 's1' }
                            ]
                        },
                        options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true, display: false } } }
                    });
                    return () => { if (chartInstance.current) chartInstance.current.destroy(); };
                }, [data]);

                const final = data[data.length - 1] || { principal: 0, total: 0, interest: 0 };

                return (
                    <div className="grid md:grid-cols-3 gap-6 animate-fade-in">
                        <div className="space-y-4">
                            <div><label className="block text-sm font-bold text-slate-600 mb-1">현재 나이</label><input type="number" value={vals.age} onChange={e => setVals({ ...vals, age: Number(e.target.value) })} className="w-full p-2 border rounded" /></div>
                            <div><label className="block text-sm font-bold text-slate-600 mb-1">월 저축액</label><input type="range" min="100000" max="5000000" step="50000" value={vals.save} onChange={e => setVals({ ...vals, save: Number(e.target.value) })} className="w-full mb-2 accent-blue-600" /><input type="text" value={formatMoney(vals.save)} readOnly className="w-full p-2 border rounded text-right font-mono bg-slate-50" /></div>
                            <div><label className="block text-sm font-bold text-slate-600 mb-1">수익률 ({vals.rate}%)</label><input type="range" min="1" max="15" step="0.5" value={vals.rate} onChange={e => setVals({ ...vals, rate: Number(e.target.value) })} className="w-full accent-green-600" /></div>
                            <div><label className="block text-sm font-bold text-slate-600 mb-1">기간 ({vals.years}년)</label><input type="range" min="1" max="40" value={vals.years} onChange={e => setVals({ ...vals, years: Number(e.target.value) })} className="w-full accent-purple-600" /><p className="text-xs text-right text-purple-600">만기: {vals.age + vals.years}세</p></div>
                        </div>
                        <div className="md:col-span-2 bg-slate-50 p-4 rounded-xl border border-slate-200">
                            <div className="h-48 w-full mb-4 relative"><canvas ref={chartRef}></canvas></div>
                            <div className="grid grid-cols-3 gap-2 text-center">
                                <div className="bg-white p-2 rounded shadow-sm border"><p className="text-xs text-slate-500">원금</p><p className="font-bold text-slate-700">{formatMoney(final.principal)}</p></div>
                                <div className="bg-blue-50 p-2 rounded shadow-sm border border-blue-100"><p className="text-xs text-blue-500">이자</p><p className="font-bold text-blue-600">+{formatMoney(final.interest)}</p></div>
                                <div className="bg-indigo-50 p-2 rounded shadow-sm border border-indigo-100"><p className="text-xs text-indigo-500">총 자산</p><p className="font-bold text-indigo-700">{formatMoney(final.total)}</p></div>
                            </div>
                        </div>
                    </div>
                );
            };

            const DelayCost = () => {
                const [v, setV] = useState({ age: 40, goal: 100000000, years: 20, delay: 5, rate: 6 });

                const calcPMT = (target, r, n) => {
                    if (n <= 0) return 0;
                    const mr = r / 100 / 12;
                    const mo = n * 12;
                    return target / ((Math.pow(1 + mr, mo) - 1) / mr);
                };

                const nowPMT = calcPMT(v.goal, v.rate, v.years);
                const delayPMT = calcPMT(v.goal, v.rate, v.years - v.delay);
                const costNow = nowPMT * 12 * v.years;
                const costDelay = delayPMT * 12 * (v.years - v.delay);
                const waste = costDelay - costNow;

                return (
                    <div className="grid md:grid-cols-2 gap-8 animate-fade-in">
                        <div className="space-y-4 p-4 border rounded-xl bg-white">
                            <div><label className="text-sm font-bold text-slate-600">목표 금액</label><input type="number" value={v.goal} onChange={e => setV({ ...v, goal: Number(e.target.value) })} className="w-full p-2 border rounded font-mono" /></div>
                            <div><label className="text-sm font-bold text-slate-600">준비 기간 ({v.years}년)</label><input type="range" min="5" max="40" value={v.years} onChange={e => setV({ ...v, years: Number(e.target.value) })} className="w-full accent-blue-600" /></div>
                            <div><label className="text-sm font-bold text-slate-600">지연 기간 ({v.delay}년)</label><input type="range" min="1" max={v.years - 1} value={v.delay} onChange={e => setV({ ...v, delay: Number(e.target.value) })} className="w-full accent-red-500" /></div>
                            <div><label className="text-sm font-bold text-slate-600">수익률 ({v.rate}%)</label><input type="range" min="2" max="10" step="0.5" value={v.rate} onChange={e => setV({ ...v, rate: Number(e.target.value) })} className="w-full accent-green-600" /></div>
                        </div>
                        <div className="space-y-4">
                            <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                <h5 className="font-bold text-blue-800 text-sm mb-2">지금 시작하면 (월 저축액)</h5>
                                <p className="text-2xl font-bold text-blue-600">{formatMoney(nowPMT)}원</p>
                                <p className="text-xs text-blue-400">총 납입: {formatMoney(costNow)}</p>
                            </div>
                            <div className="bg-red-50 p-4 rounded-xl border border-red-100">
                                <h5 className="font-bold text-red-800 text-sm mb-2">{v.delay}년 뒤 시작하면 (월 저축액)</h5>
                                <p className="text-2xl font-bold text-red-600">{formatMoney(delayPMT)}원</p>
                                <p className="text-xs text-red-400">총 납입: {formatMoney(costDelay)}</p>
                            </div>
                            <div className="bg-slate-800 text-white p-4 rounded-xl text-center">
                                <p className="text-sm text-slate-300 mb-1">게으름 비용 (더 내야 하는 돈)</p>
                                <p className="text-2xl font-bold text-yellow-400">+{formatMoney(waste)}원</p>
                            </div>
                        </div>
                    </div>
                );
            };

            const RetirementPlan = () => {
                const [p, setP] = useState({ age: 40, pension: 3000000, saveYears: 10, saveRate: 5, deferYears: 15, deferRate: 5 });

                const targetCorpus = (p.pension * 12) / 0.07; // 7% rule
                const reqFVSave = targetCorpus / Math.pow(1 + p.deferRate / 100, p.deferYears);
                const mRate = p.saveRate / 100 / 12;
                const reqMonthly = reqFVSave / ((Math.pow(1 + mRate, p.saveYears * 12) - 1) / mRate);

                return (
                    <div className="grid md:grid-cols-2 gap-6 animate-fade-in">
                        <div className="space-y-4">
                            <div className="bg-slate-50 p-4 rounded-xl border">
                                <h4 className="font-bold text-slate-700 text-sm mb-2">1. 목표 설정</h4>
                                <label className="text-xs block text-slate-500">희망 월 은퇴생활비</label>
                                <input type="number" value={p.pension} onChange={e => setP({ ...p, pension: Number(e.target.value) })} className="w-full p-2 border rounded font-bold text-right text-blue-900" />
                                <div className="mt-2 text-right text-xs text-blue-600 font-bold">필요 목돈(7%배당): {formatMoney(targetCorpus)}</div>
                            </div>
                            <div className="bg-white p-4 rounded-xl border">
                                <h4 className="font-bold text-slate-700 text-sm mb-2">2. 저축 & 거치</h4>
                                <div className="mb-4">
                                    <div className="flex justify-between text-xs font-bold text-green-700 mb-1"><span>모으는 기간</span><span>{p.saveYears}년</span></div>
                                    <input type="range" min="1" max="30" value={p.saveYears} onChange={e => setP({ ...p, saveYears: Number(e.target.value) })} className="w-full accent-green-600" />
                                </div>
                                <div>
                                    <div className="flex justify-between text-xs font-bold text-purple-700 mb-1"><span>불리는 기간 (거치)</span><span>{p.deferYears}년</span></div>
                                    <input type="range" min="0" max="30" value={p.deferYears} onChange={e => setP({ ...p, deferYears: Number(e.target.value) })} className="w-full accent-purple-600" />
                                </div>
                            </div>
                        </div>
                        <div className="bg-slate-900 text-white rounded-xl p-6 flex flex-col justify-center text-center relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-green-500 via-purple-500 to-blue-500"></div>
                            <h4 className="text-slate-400 text-sm mb-4">목표 달성을 위한 월 저축액</h4>
                            <p className="text-4xl font-bold text-yellow-400 mb-2">{formatMoney(reqMonthly)}</p>
                            <p className="text-xs text-slate-500">{p.saveYears}년 동안 매월 납입 시</p>
                            <div className="mt-6 space-y-2 text-left text-xs bg-slate-800 p-4 rounded">
                                <div className="flex justify-between"><span className="text-green-400">1단계 목돈</span><span>{formatMoney(reqFVSave)}</span></div>
                                <div className="flex justify-between"><span className="text-purple-400">2단계 굴리기</span><span>{formatMoney(targetCorpus)}</span></div>
                                <div className="flex justify-between border-t border-slate-700 pt-2"><span className="text-blue-400 font-bold">3단계 평생월급</span><span className="text-yellow-400 font-bold">{formatMoney(p.pension)}</span></div>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="p-4 md:p-8 h-full flex flex-col">
                    <div className="flex gap-2 bg-slate-100 p-1 rounded-lg self-start mb-6">
                        {['compound', 'delay', 'retirement'].map(t => (
                            <button key={t} onClick={() => setActiveTab(t)} className={`px-4 py-2 rounded-md text-sm font-bold transition-all ${activeTab === t ? 'bg-white text-blue-600 shadow' : 'text-slate-400 hover:text-slate-600'}`}>
                                {t === 'compound' ? '복리 계산' : t === 'delay' ? '게으름 비용' : '은퇴 설계'}
                            </button>
                        ))}
                    </div>
                    <div className="flex-1 overflow-y-auto custom-scroll pb-20">
                        {activeTab === 'compound' && <CompoundCalc />}
                        {activeTab === 'delay' && <DelayCost />}
                        {activeTab === 'retirement' && <RetirementPlan />}
                    </div>
                </div>
            );
        };

        // ==========================================
        // MODULE 3: Life Cycle
        // ==========================================
        const LifeCycle = () => {
            const [age, setAge] = useState(30);
            const [goals, setGoals] = useState([
                { id: 1, age: 35, label: '주택 마련', amount: 300000000, track: 0 },
                { id: 2, age: 60, label: '은퇴 시작', amount: 500000000, track: 0 }
            ]);
            const [input, setInput] = useState({ name: '', amount: '', yearOffset: 3 });

            const addGoal = () => {
                if (!input.name) return;
                const newAge = age + Number(input.yearOffset);
                const newGoal = { id: Date.now(), age: newAge, label: input.name, amount: Number(input.amount), track: 0 };

                // Track calculation logic (simplified stacking)
                const sorted = [...goals, newGoal].sort((a, b) => a.age - b.age);
                const occupancy = {};
                const tracked = sorted.map(g => {
                    let t = 0;
                    const start = g.age;
                    const end = g.age + 4;
                    while (true) {
                        let clash = false;
                        for (let k = start; k <= end; k++) {
                            if (occupancy[k] && occupancy[k][t]) clash = true;
                        }
                        if (!clash) break;
                        t++;
                    }
                    for (let k = start; k <= end; k++) {
                        if (!occupancy[k]) occupancy[k] = [];
                        occupancy[k][t] = true;
                    }
                    return { ...g, track: t };
                });

                setGoals(tracked);
                setInput({ name: '', amount: '', yearOffset: 3 });
            };

            const timelineRef = useRef(null);
            const presets = [
                { name: '결혼 자금', amt: 50000000 }, { name: '주택 확장', amt: 100000000 },
                { name: '자녀 대학', amt: 40000000 }, { name: '세계 여행', amt: 10000000 }
            ];

            return (
                <div className="flex flex-col h-full overflow-hidden">
                    <div className="p-4 bg-white border-b flex flex-wrap gap-4 items-end z-10 shadow-sm">
                        <div>
                            <label className="block text-xs font-bold text-slate-400">현재 나이</label>
                            <input type="number" value={age} onChange={e => setAge(Number(e.target.value))} className="border-b font-bold w-16 text-center focus:outline-none" />
                        </div>
                        <div className="flex gap-2 items-end">
                            <div>
                                <label className="block text-xs font-bold text-slate-400">목표명</label>
                                <input type="text" value={input.name} onChange={e => setInput({ ...input, name: e.target.value })} className="border-b w-32 focus:outline-none text-sm" />
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-400">금액</label>
                                <input type="number" value={input.amount} onChange={e => setInput({ ...input, amount: e.target.value })} className="border-b w-24 focus:outline-none text-sm" />
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-400">몇 년 뒤?</label>
                                <input type="number" value={input.yearOffset} onChange={e => setInput({ ...input, yearOffset: e.target.value })} className="border-b w-12 text-center focus:outline-none text-sm" />
                            </div>
                            <button onClick={addGoal} className="bg-indigo-600 text-white px-3 py-1 rounded text-sm font-bold hover:bg-indigo-700">추가</button>
                        </div>
                        <div className="flex gap-2 ml-auto">
                            {presets.map((p, i) => (
                                <button key={i} onClick={() => { setInput({ name: p.name, amount: p.amt, yearOffset: 3 }) }} className="text-xs bg-slate-100 px-2 py-1 rounded hover:bg-slate-200 text-slate-600">
                                    + {p.name}
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="flex-1 overflow-x-auto overflow-y-hidden custom-scroll relative bg-slate-50" ref={timelineRef}>
                        <div className="h-full relative flex" style={{ minWidth: 'max-content', padding: '60px 20px 20px 20px' }}>
                            {Array.from({ length: 61 }, (_, i) => age + i).map((a, i) => {
                                const isDecade = a % 10 === 0;
                                const isCurrent = a === age;
                                const theseGoals = goals.filter(g => g.age === a);
                                return (
                                    <div key={a} className={`flex-shrink-0 w-12 h-full border-r border-slate-200 relative ${isCurrent ? 'bg-indigo-50' : ''}`}>
                                        <div className={`absolute bottom-0 w-full text-center text-xs pb-2 ${isDecade ? 'font-bold text-slate-800' : 'text-slate-400'}`}>{a}</div>
                                        {isCurrent && <div className="absolute top-0 bottom-8 left-1/2 w-0.5 bg-indigo-400 border-dashed border-l"></div>}
                                        {theseGoals.map(g => (
                                            <div key={g.id} className="absolute left-1 bg-white border-l-4 border-indigo-500 shadow-md p-1 rounded text-[10px] z-10 w-32 cursor-pointer hover:scale-105 transition-transform"
                                                style={{ bottom: `${40 + g.track * 50}px` }}
                                                onClick={() => setGoals(goals.filter(x => x.id !== g.id))}
                                            >
                                                <div className="font-bold truncate">{g.label}</div>
                                                <div className="text-slate-500">{formatMoney(g.amount)}</div>
                                            </div>
                                        ))}
                                    </div>
                                )
                            })}
                        </div>
                    </div>

                    <div className="bg-white border-t p-3 flex justify-between items-center text-sm">
                        <span className="font-bold text-slate-500">Total Needs</span>
                        <span className="text-xl font-bold text-indigo-700">{formatMoney(goals.reduce((a, b) => a + b.amount, 0))} 원</span>
                    </div>
                </div>
            );
        };

        // ==========================================
        // MODULE 4: Retirement Withdrawal
        // ==========================================
        const WithdrawalSim = () => {
            const [age, setAge] = useState(50);
            const [funds, setFunds] = useState([
                { id: 1, name: '국민연금', start: 65, end: 100, amt: 1500, infl: true },
                { id: 2, name: '개인연금', start: 60, end: 80, amt: 500, infl: false },
                { id: 3, name: '퇴직연금', start: 60, end: 70, amt: 1000, infl: false }
            ]);

            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            const INF = 0.02;
            const PEN_INC = 0.015;

            const updateFund = (id, field, val) => {
                setFunds(funds.map(f => f.id === id ? { ...f, [field]: val } : f));
            };

            const data = useMemo(() => {
                const res = [];
                for (let a = age; a <= 90; a++) {
                    let row = { age: a, nominal: 0, pv: 0, items: [] };
                    funds.forEach(f => {
                        let amount = 0;
                        if (a >= f.start && a <= f.end) {
                            amount = f.infl ? f.amt * Math.pow(1 + PEN_INC, a - f.start) : f.amt;
                        }
                        row.items.push(amount);
                        row.nominal += amount;
                    });
                    row.pv = row.nominal / Math.pow(1 + INF, a - age);
                    res.push(row);
                }
                return res;
            }, [age, funds]);

            useEffect(() => {
                if (!chartRef.current || data.length === 0) return;
                const ctx = chartRef.current.getContext('2d');
                if (chartInstance.current) chartInstance.current.destroy();

                const colors = ['#ef4444', '#facc15', '#22c55e'];

                const datasets = funds.map((f, i) => ({
                    label: f.name,
                    data: data.map(d => d.items[i]),
                    backgroundColor: colors[i % colors.length],
                    stack: 's1'
                }));
                datasets.push({
                    type: 'line', label: '실질가치(PV)', data: data.map(d => d.pv),
                    borderColor: '#1f2937', borderWidth: 2, tension: 0.4, pointRadius: 0
                });

                chartInstance.current = new Chart(ctx, {
                    type: 'bar',
                    data: { labels: data.map(d => d.age), datasets },
                    options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true, grid: { display: false } }, y: { stacked: true } } }
                });
                return () => { if (chartInstance.current) chartInstance.current.destroy(); };
            }, [data, funds]);

            const summary65 = data.find(d => d.age === 65) || { nominal: 0, pv: 0 };

            return (
                <div className="p-4 md:p-8 h-full overflow-y-auto custom-scroll pb-20 space-y-6">
                    <div className="grid lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 bg-white p-6 rounded-xl border shadow-sm">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold text-lg flex items-center gap-2"><Icon name="wallet" size={20} /> 자금 설정 (단위: 천원)</h3>
                                <div className="flex items-center gap-2 bg-blue-50 px-3 py-1 rounded text-sm text-blue-800 font-bold">
                                    현재 <input type="number" value={age} onChange={e => setAge(Number(e.target.value))} className="w-10 text-center bg-transparent border-b border-blue-300" />세
                                </div>
                            </div>
                            <div className="space-y-2">
                                {funds.map(f => (
                                    <div key={f.id} className="flex flex-wrap gap-2 items-center bg-slate-50 p-2 rounded">
                                        <input type="text" value={f.name} onChange={e => updateFund(f.id, 'name', e.target.value)} className="w-24 bg-transparent border-b font-bold text-sm" />
                                        <div className="flex items-center text-xs text-slate-500">
                                            <input type="number" value={f.start} onChange={e => updateFund(f.id, 'start', Number(e.target.value))} className="w-10 p-1 border rounded mx-1 text-center" />세 ~
                                            <input type="number" value={f.end} onChange={e => updateFund(f.id, 'end', Number(e.target.value))} className="w-10 p-1 border rounded mx-1 text-center" />세
                                        </div>
                                        <input type="number" value={f.amt} onChange={e => updateFund(f.id, 'amt', Number(e.target.value))} className="flex-1 min-w-[80px] p-1 border rounded text-right font-mono" />
                                        <span className="text-xs text-slate-400">천원</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                        <div className="bg-white p-6 rounded-xl border shadow-sm flex flex-col justify-center">
                            <h3 className="text-sm font-bold text-slate-400 uppercase mb-2">65세 예상 수령액</h3>
                            <div className="mb-4">
                                <p className="text-xs text-slate-500">명목 금액</p>
                                <p className="text-3xl font-bold text-blue-600 font-mono">{formatMoney(summary65.nominal)}<span className="text-sm text-slate-400 ml-1">천원</span></p>
                            </div>
                            <div className="pt-4 border-t">
                                <p className="text-xs text-slate-500">실질 가치 (물가 2% 반영)</p>
                                <p className="text-xl font-bold text-slate-700 font-mono">{formatMoney(summary65.pv)}<span className="text-sm text-slate-400 ml-1">천원</span></p>
                            </div>
                        </div>
                    </div>
                    <div className="bg-white p-6 rounded-xl border shadow-sm h-80 relative">
                        <canvas ref={chartRef}></canvas>
                    </div>
                </div>
            );
        };

        // ==========================================
        // MAIN APP SHELL
        // ==========================================
        const App = () => {
            const [module, setModule] = useState('wealth');
            const [isMenuOpen, setIsMenuOpen] = useState(false);

            const MenuBtn = ({ id, label, icon }) => (
                <button onClick={() => { setModule(id); setIsMenuOpen(false); }}
                    className={`flex items-center gap-3 w-full p-3 rounded-xl transition-all ${module === id ? 'bg-navy-900 text-white shadow-lg shadow-navy-900/20' : 'text-slate-500 hover:bg-slate-100'}`}>
                    <Icon name={icon} size={20} className={module === id ? "text-bronze-400" : "text-slate-400"} />
                    <span className="font-bold text-sm">{label}</span>
                </button>
            );

            return (
                <div className="flex w-full h-full bg-slate-50">
                    {/* Sidebar (Desktop) */}
                    <div className="hidden md:flex w-64 bg-white border-r border-slate-200 flex-col p-4 z-20">
                        <div className="mb-8 flex items-center gap-3 px-2">
                            <div className="w-8 h-8 bg-navy-900 rounded-lg flex items-center justify-center text-bronze-500 font-black text-sm">1</div>
                            <div>
                                <h1 className="font-bold text-navy-900 leading-none">The One</h1>
                                <p className="text-[10px] text-slate-400 font-bold tracking-widest uppercase">Master Suite</p>
                            </div>
                        </div>
                        <nav className="space-y-2">
                            <MenuBtn id="wealth" label="Wealth Simulator" icon="trending-up" />
                            <MenuBtn id="sales" label="Sales Master" icon="briefcase" />
                            <MenuBtn id="life" label="Life Cycle" icon="calendar" />
                            <MenuBtn id="withdrawal" label="Retirement Plan" icon="pie-chart" />
                        </nav>
                        <div className="mt-auto pt-6 border-t border-slate-100">
                            <p className="text-[10px] text-slate-400 text-center">© 2024 The One Asset Management</p>
                        </div>
                    </div>

                    {/* Mobile Bottom Nav */}
                    <div className="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-slate-200 flex justify-around p-2 z-50 safe-area-bottom">
                        {['wealth', 'sales', 'life', 'withdrawal'].map(id => (
                            <button key={id} onClick={() => setModule(id)} className={`p-2 rounded-lg flex flex-col items-center gap-1 ${module === id ? 'text-navy-900' : 'text-slate-400'}`}>
                                <Icon name={id === 'wealth' ? 'trending-up' : id === 'sales' ? 'briefcase' : id === 'life' ? 'calendar' : 'pie-chart'} size={20} />
                                <span className="text-[10px] font-bold">{id.charAt(0).toUpperCase() + id.slice(1)}</span>
                            </button>
                        ))}
                    </div>

                    {/* Main Content Area */}
                    <div className="flex-1 flex flex-col h-full overflow-hidden relative">
                        {/* Mobile Header */}
                        <div className="md:hidden bg-white border-b border-slate-200 p-4 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="w-6 h-6 bg-navy-900 rounded flex items-center justify-center text-bronze-500 font-bold text-xs">1</div>
                                <span className="font-bold text-navy-900">Financial Master</span>
                            </div>
                        </div>

                        {/* Content Render */}
                        <div className="flex-1 relative overflow-hidden">
                            {module === 'wealth' && <WealthGrowth />}
                            {module === 'sales' && <SalesMaster />}
                            {module === 'life' && <LifeCycle />}
                            {module === 'withdrawal' && <WithdrawalSim />}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>