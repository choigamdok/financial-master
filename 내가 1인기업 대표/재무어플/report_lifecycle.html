<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒì• ì£¼ê¸° ì¬ë¬´ ì„¤ê³„ ë³´ê³ ì„œ (Life Cycle)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @page {
            size: A4;
            margin: 20mm;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: white;
            color: #1f2937;
        }

        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .no-print {
                display: none !important;
            }

            .page-break {
                page-break-after: always;
            }
        }

        .report-header {
            border-bottom: 4px solid #4f46e5;
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }

        .report-section {
            margin-bottom: 2rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .data-table th,
        .data-table td {
            border: 1px solid #e5e7eb;
            padding: 0.75rem;
            text-align: left;
        }

        .data-table th {
            background-color: #f3f4f6;
            font-weight: 600;
        }

        .highlight-box {
            background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
        }

        .timeline-container {
            position: relative;
            margin-top: 2rem;
            margin-bottom: 2rem;
            padding-left: 1rem;
        }

        .timeline-item {
            position: relative;
            padding-left: 2rem;
            padding-bottom: 2rem;
            border-left: 2px solid #e5e7eb;
        }

        .timeline-item:last-child {
            border-left: none;
        }

        .timeline-dot {
            position: absolute;
            left: -9px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #4f46e5;
            border: 2px solid white;
            box-shadow: 0 0 0 2px #4f46e5;
        }
    </style>
</head>

<body class="p-8 max-w-4xl mx-auto">
    <!-- í”„ë¦°íŠ¸ ë²„íŠ¼ -->
    <div class="no-print mb-6 text-right">
        <button onclick="window.print()"
            class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 transition">
            ğŸ–¨ï¸ ì¸ì‡„ / PDF ì €ì¥
        </button>
    </div>

    <!-- í—¤ë” -->
    <div class="report-header">
        <div class="flex justify-between items-start">
            <div>
                <h1 class="text-3xl font-black text-gray-900 mb-2">ìƒì• ì£¼ê¸° ì¬ë¬´ ì„¤ê³„ ë³´ê³ ì„œ</h1>
                <p class="text-sm text-gray-500">Life Cycle Financial Plan Report</p>
            </div>
            <div class="text-right text-sm text-gray-600">
                <p id="report-date"></p>
                <p class="font-bold text-indigo-600 mt-1">ê¸ˆì‡¼ë§˜ì˜ ê¸ˆìœµìŠ¤ì¿¨</p>
            </div>
        </div>
    </div>

    <!-- ê³ ê° ì •ë³´ -->
    <div class="report-section">
        <h2 class="text-xl font-bold text-gray-900 mb-4 pb-2 border-b-2 border-gray-200">ğŸ“‹ ê³ ê° ì •ë³´</h2>
        <table class="data-table">
            <tr>
                <th class="w-1/4">ê³ ê°ëª…</th>
                <td id="client-name"></td>
                <th class="w-1/4">í˜„ì¬ ë‚˜ì´</th>
                <td id="client-age"></td>
            </tr>
            <tr>
                <th>ë¶„ì„ ëª©ì </th>
                <td colspan="3"><span id="analysis-purpose"></span></td>
            </tr>
        </table>
    </div>

    <!-- ì´ í•„ìš” ìê¸ˆ ìš”ì•½ -->
    <div class="report-section">
        <h2 class="text-xl font-bold text-gray-900 mb-4 pb-2 border-b-2 border-gray-200">ğŸ’° ì´ í•„ìš” ìê¸ˆ ìš”ì•½</h2>
        <div class="highlight-box">
            <p class="text-indigo-100 mb-2 font-medium">ìƒì• ì£¼ê¸° ì „ì²´ í•„ìš” ìê¸ˆ</p>
            <p class="text-4xl font-black mb-2" id="total-amount"></p>
            <p class="text-sm text-indigo-100 opacity-90">ë“±ë¡ëœ ëª¨ë“  ì¬ë¬´ ëª©í‘œì˜ í•©ê³„ì…ë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- ìê¸ˆ íë¦„ ì°¨íŠ¸ -->
    <div class="report-section">
        <h2 class="text-xl font-bold text-gray-900 mb-4 pb-2 border-b-2 border-gray-200">ğŸ“Š ì—°ë ¹ë³„ í•„ìš” ìê¸ˆ íë¦„</h2>
        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
            <canvas id="lifecycleChart" style="max-height: 350px;"></canvas>
        </div>
    </div>

    <!-- ìƒì•  ì´ë²¤íŠ¸ íƒ€ì„ë¼ì¸ -->
    <div class="report-section page-break">
        <h2 class="text-xl font-bold text-gray-900 mb-4 pb-2 border-b-2 border-gray-200">ğŸš€ ì£¼ìš” ì¬ë¬´ ì´ë²¤íŠ¸ ëª©ë¡</h2>
        <div class="timeline-container" id="timeline-list">
            <!-- JSë¡œ ìƒì„±ë¨ -->
            <p class="text-gray-500 text-center py-4">ë“±ë¡ëœ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- ê¶Œì¥ ì‚¬í•­ -->
    <div class="report-section">
        <h2 class="text-xl font-bold text-gray-900 mb-4 pb-2 border-b-2 border-gray-200">ğŸ’¡ ì¬ë¬´ ì„¤ê³„ì‚¬ ì¡°ì–¸</h2>
        <div class="bg-indigo-50 p-6 rounded-lg border-l-4 border-indigo-500">
            <ul class="space-y-2 text-gray-700">
                <li class="flex items-start gap-2">
                    <span class="text-indigo-600 font-bold">â€¢</span>
                    <span>ì¸ìƒì˜ ì£¼ìš” ì´ë²¤íŠ¸ë¥¼ ë¯¸ë¦¬ ê³„íší•˜ê³  ì¤€ë¹„í•˜ë©´ ì¬ë¬´ì  ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-indigo-600 font-bold">â€¢</span>
                    <span>ë‹¨ê¸° ëª©í‘œ(1~3ë…„)ëŠ” ì•ˆì „ ìì‚°ìœ¼ë¡œ, ì¥ê¸° ëª©í‘œ(10ë…„ ì´ìƒ)ëŠ” íˆ¬ì ìì‚°ìœ¼ë¡œ ì¤€ë¹„í•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì ì…ë‹ˆë‹¤.</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-indigo-600 font-bold">â€¢</span>
                    <span>ë¬¼ê°€ ìƒìŠ¹ì„ ê³ ë ¤í•˜ì—¬ ì¥ê¸° ëª©í‘œì˜ ê²½ìš° ì‹¤ì œ í•„ìš” ê¸ˆì•¡ì€ ë” ì»¤ì§ˆ ìˆ˜ ìˆìŒì„ ìœ ì˜í•˜ì„¸ìš”.</span>
                </li>
            </ul>
        </div>
    </div>

    <!-- ë©´ì±… ì¡°í•­ -->
    <div class="report-section text-xs text-gray-500 border-t pt-4 mt-8">
        <p class="mb-2">
            <strong>ë©´ì±… ì¡°í•­:</strong> ë³¸ ë³´ê³ ì„œì˜ ë¶„ì„ ê²°ê³¼ëŠ” ì…ë ¥ëœ ê°€ì •ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‹œë®¬ë ˆì´ì…˜ì´ë©°, ì‹¤ì œ íˆ¬ì ìˆ˜ìµì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            íˆ¬ì ê²°ì • ì‹œì—ëŠ” ì‹œì¥ ìƒí™©, ê°œì¸ì˜ ì¬ë¬´ ìƒíƒœ, ë¦¬ìŠ¤í¬ ì„±í–¥ ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
        </p>
        <p class="text-center mt-4 text-gray-400">
            Â© 2024-2026 ê¸ˆì‡¼ë§˜ì˜ ê¸ˆìœµìŠ¤ì¿¨. All rights reserved.
        </p>
    </div>

    <script>
        // ë‚ ì§œ ì„¤ì •
        document.getElementById('report-date').textContent = new Date().toLocaleDateString('ko-KR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        // 1. URL íŒŒë¼ë¯¸í„° íŒŒì‹±
        const params = new URLSearchParams(window.location.search);
        // JSON ë¬¸ìì—´ë¡œ ì¸ì½”ë”©ëœ goals ë°ì´í„°ë¥¼ íŒŒì‹±
        let goals = [];
        try {
            const goalsStr = params.get('goals');
            if (goalsStr) {
                goals = JSON.parse(decodeURIComponent(goalsStr));
            }
        } catch (e) {
            console.error('Goals parsing error:', e);
        }

        const reportData = {
            clientName: params.get('clientName') || 'ê³ ê°ëª…',
            clientAge: params.get('clientAge') || '-',
            purpose: params.get('purpose') || 'ìƒì•  ì¬ë¬´ ì„¤ê³„',
            currentAge: parseInt(params.get('currentAge')) || 30,
            totalAmount: parseInt(params.get('totalAmount')) || 0
        };

        const formatMoney = (n) => new Intl.NumberFormat('ko-KR').format(Math.round(n)) + 'ì›';

        // 2. ë°ì´í„° í‘œì‹œ
        document.getElementById('client-name').textContent = reportData.clientName;
        document.getElementById('client-age').textContent = reportData.clientAge + 'ì„¸ (' + reportData.currentAge + 'ì„¸ ê¸°ì¤€ ì„¤ê³„)';
        document.getElementById('analysis-purpose').textContent = reportData.purpose;
        document.getElementById('total-amount').textContent = formatMoney(reportData.totalAmount);

        // 3. íƒ€ì„ë¼ì¸ ëª©ë¡ ìƒì„±
        const timelineList = document.getElementById('timeline-list');

        // ë‚˜ì´ìˆœ ì •ë ¬
        goals.sort((a, b) => a.age - b.age);

        if (goals.length > 0) {
            timelineList.innerHTML = '';

            // 10ë…„ ë‹¨ìœ„ë¡œ ê·¸ë£¹í•‘í•˜ê±°ë‚˜ ê·¸ëƒ¥ ë¦¬ìŠ¤íŠ¸ì—…
            goals.forEach(goal => {
                const diffYear = goal.age - reportData.currentAge;
                const dDay = diffYear > 0 ? `(${diffYear}ë…„ í›„)` : (diffYear === 0 ? '(ì˜¬í•´)' : '');

                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `
                    <div class="timeline-dot"></div>
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="inline-block bg-indigo-100 text-indigo-800 text-xs font-bold px-2 py-1 rounded mb-1">${goal.age}ì„¸ ${dDay}</span>
                            <h3 class="text-lg font-bold text-gray-800">${goal.label}</h3>
                        </div>
                        <div class="text-right">
                             <p class="text-xl font-bold text-indigo-600">${formatMoney(goal.amount)}</p>
                        </div>
                    </div>
                `;
                timelineList.appendChild(item);
            });
        }

        // 4. ì°¨íŠ¸ ìƒì„±
        // ì—°ë ¹ëŒ€ë³„ í•©ê³„ ê³„ì‚° (30ëŒ€, 40ëŒ€, 50ëŒ€, 60ëŒ€ ì´í›„)
        const ageGroups = { '30s': 0, '40s': 0, '50s': 0, '60plus': 0 };

        goals.forEach(goal => {
            if (goal.age < 40) ageGroups['30s'] += goal.amount;
            else if (goal.age < 50) ageGroups['40s'] += goal.amount;
            else if (goal.age < 60) ageGroups['50s'] += goal.amount;
            else ageGroups['60plus'] += goal.amount;
        });

        const ctx = document.getElementById('lifecycleChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['30ëŒ€ (ê°€ì •í˜•ì„±ê¸°)', '40ëŒ€ (ìë…€ì„±ì¥ê¸°)', '50ëŒ€ (ì€í‡´ì¤€ë¹„ê¸°)', '60ëŒ€ ì´í›„ (ë…¸í›„ìƒí™œê¸°)'],
                datasets: [{
                    label: 'í•„ìš” ìê¸ˆ í•©ê³„',
                    data: [ageGroups['30s'], ageGroups['40s'], ageGroups['50s'], ageGroups['60plus']],
                    backgroundColor: [
                        'rgba(34, 197, 94, 0.6)',  // Green (30s)
                        'rgba(234, 179, 8, 0.6)',  // Yellow (40s)
                        'rgba(249, 115, 22, 0.6)', // Orange (50s)
                        'rgba(107, 114, 128, 0.6)' // Gray (60+)
                    ],
                    borderColor: [
                        'rgb(34, 197, 94)',
                        'rgb(234, 179, 8)',
                        'rgb(249, 115, 22)',
                        'rgb(107, 114, 128)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => ' í•©ê³„: ' + formatMoney(ctx.parsed.y)
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: (value) => {
                                if (value >= 100000000) return (value / 100000000).toFixed(0) + 'ì–µ';
                                if (value >= 10000) return (value / 10000).toFixed(0) + 'ë§Œ';
                                return value;
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>

</html>