<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ì¬ë¬´ì„¤ê³„ ë§ˆìŠ¤í„° - í†µí•© ì¬ë¬´ ê³„ì‚°ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <style>
        * {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        }

        /* í† ìŠ¤ ìŠ¤íƒ€ì¼ ë³€ìˆ˜ */
        :root {
            --toss-blue: #0064FF;
            --toss-blue-dark: #0052CC;
            --toss-black: #191F28;
            --toss-gray: #4E5968;
            --toss-green: #00C73C;
            --toss-red: #FF5A5F;
            --toss-bg: #F9FAFB;
        }

        body {
            background: var(--toss-bg);
            color: var(--toss-black);
        }

        /* íƒ­ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* í† ìŠ¤ ìŠ¤íƒ€ì¼ ì¹´ë“œ */
        .toss-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
            transition: all 0.2s;
        }

        .toss-card:hover {
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12);
        }

        /* í† ìŠ¤ ë²„íŠ¼ */
        .toss-btn {
            border-radius: 12px;
            font-weight: 700;
            transition: all 0.2s;
            padding: 16px 24px;
            font-size: 16px;
        }

        .toss-btn-primary {
            background: var(--toss-blue);
            color: white;
        }

        .toss-btn-primary:hover {
            background: var(--toss-blue-dark);
            transform: translateY(-2px);
        }

        /* í† ìŠ¤ ì¸í’‹ */
        .toss-input {
            border: 2px solid #E5E8EB;
            border-radius: 12px;
            padding: 14px 16px;
            font-size: 16px;
            transition: border 0.2s;
            width: 100%;
        }

        .toss-input:focus {
            border-color: var(--toss-blue);
            outline: none;
        }

        /* ìˆ«ì ê°•ì¡° */
        .toss-number {
            font-weight: 800;
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.02em;
        }

        /* ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        /* í”„ë¦°íŠ¸ ë° PDF ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-print,
        .btn-pdf {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 700;
            font-size: 0.875rem;
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            border: none;
        }

        .btn-print {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .btn-print:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
            transform: translateY(-1px);
        }

        .btn-pdf {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-pdf:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
            transform: translateY(-1px);
        }

        /* í”„ë¦°íŠ¸ ì‹œ ìŠ¤íƒ€ì¼ */
        @media print {

            /* í”„ë¦°íŠ¸ ì‹œ ìˆ¨ê¸¸ ìš”ì†Œ */
            .no-print,
            header,
            .tab-btn,
            nav,
            button,
            input[type="range"],
            input[type="number"],
            input[type="text"],
            select {
                display: none !important;
            }

            /* í˜ì´ì§€ ì„¤ì • */
            @page {
                margin: 20mm;
                size: A4;
            }

            body {
                background: white;
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            /* ê²°ê³¼ ì„¹ì…˜ì€ ë³´ì´ë„ë¡ */
            .tab-content.active {
                display: block !important;
            }

            /* ì°¨íŠ¸ í¬ê¸° ì¡°ì • */
            canvas {
                max-width: 100% !important;
                height: auto !important;
            }

            /* í…Œì´ë¸” ì¸ì‡„ ìµœì í™” */
            table {
                page-break-inside: avoid;
            }

            /* ì¹´ë“œ ìŠ¤íƒ€ì¼ ìœ ì§€ */
            .toss-card {
                page-break-inside: avoid;
                border: 1px solid #e5e7eb;
                box-shadow: none;
            }
        }
    </style>
</head>

<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-blue-500 text-white sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl sm:text-3xl font-black tracking-tight">ì¬ë¬´ì„¤ê³„ ë§ˆìŠ¤í„°</h1>
                    <p class="text-blue-100 text-sm mt-1">ëª¨ë“  ì¬ë¬´ ê³„ì‚°ì„ í•œ ê³³ì—ì„œ</p>
                </div>
                <div class="hidden sm:block text-right">
                    <p class="text-sm font-bold tracking-wide">Financial Master Calculator</p>
                    <p class="text-xs text-blue-100 mt-0.5">ê¸ˆì‡¼ë§˜ì˜ ê¸ˆìœµìŠ¤ì¿¨</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-white border-b border-gray-200 sticky top-[88px] sm:top-[96px] z-40 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex overflow-x-auto gap-2 py-3 scrollbar-hide">
                <!-- 1. í™©ê¸ˆ ê±°ìœ„ ë§Œë“¤ê¸° (Active) -->
                <button onclick="switchTab('retirement', event)"
                    class="tab-btn active whitespace-nowrap px-4 py-2.5 rounded-full font-bold text-sm transition-all flex flex-col items-center leading-tight">
                    <span>ğŸ¯ 1. í™©ê¸ˆ ê±°ìœ„ (ì€í‡´ ì¤€ë¹„)</span>
                    <span class="text-[10px] font-normal opacity-75 mt-0.5">Golden Goose</span>
                </button>

                <!-- 2. ì€í‡´ ì¸ì¶œ ì„¤ê³„ -->
                <button onclick="switchTab('withdrawal', event)"
                    class="tab-btn whitespace-nowrap px-4 py-2.5 rounded-full font-bold text-sm transition-all flex flex-col items-center leading-tight">
                    <span>ğŸ’³ 2. ì€í‡´ ì¸ì¶œ (ì€í‡´ ìƒí™œ)</span>
                    <span class="text-[10px] font-normal opacity-75 mt-0.5">Withdrawal Plan</span>
                </button>

                <!-- 3. ë¼ì´í”„ ì‚¬ì´í´ -->
                <button onclick="switchTab('lifecycle', event)"
                    class="tab-btn whitespace-nowrap px-4 py-2.5 rounded-full font-bold text-sm transition-all flex flex-col items-center leading-tight">
                    <span>ğŸ“… 3. ë¼ì´í”„ ì‚¬ì´í´</span>
                    <span class="text-[10px] font-normal opacity-75 mt-0.5">Life Cycle</span>
                </button>

                <!-- 4. ë³µë¦¬ì˜ ë§ˆë²• -->
                <button onclick="switchTab('monthly-compound', event)"
                    class="tab-btn whitespace-nowrap px-4 py-2.5 rounded-full font-bold text-sm transition-all flex flex-col items-center leading-tight">
                    <span>ğŸ“ˆ 4. ë³µë¦¬ì˜ ë§ˆë²•</span>
                    <span class="text-[10px] font-normal opacity-75 mt-0.5">Compound Magic</span>
                </button>

                <!-- 5. ìˆ˜ìµìœ¨ ë¹„êµ -->
                <button onclick="switchTab('compound', event)"
                    class="tab-btn whitespace-nowrap px-4 py-2.5 rounded-full font-bold text-sm transition-all flex flex-col items-center leading-tight">
                    <span>ğŸ’° 5. ìˆ˜ìµìœ¨ ë¹„êµ</span>
                    <span class="text-[10px] font-normal opacity-75 mt-0.5">Return Compare</span>
                </button>

                <!-- 6. ê²Œìœ¼ë¦„ ë¹„ìš© -->
                <button onclick="switchTab('delay', event)"
                    class="tab-btn whitespace-nowrap px-4 py-2.5 rounded-full font-bold text-sm transition-all flex flex-col items-center leading-tight">
                    <span>â° 6. ê²Œìœ¼ë¦„ ë¹„ìš©</span>
                    <span class="text-[10px] font-normal opacity-75 mt-0.5">Cost of Delay</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Tab 1: ë³µë¦¬ ì„±ì¥ -->
        <div id="tab-compound" class="tab-content">
            <div class="mb-8 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6 border border-blue-100">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center text-white font-black text-xl shadow-lg">
                            1
                        </div>
                        <div>
                            <h2 class="text-2xl font-black text-gray-900">ğŸ’° ìˆ˜ìµìœ¨ ë¹„êµ</h2>
                            <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mt-0.5">Wealth Growth
                                Simulator</p>
                        </div>
                    </div>
                    <!-- ë³´ê³ ì„œ ìƒì„± ë²„íŠ¼ -->
                    <button onclick="openReportModal()"
                        class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-5 py-2.5 rounded-lg font-bold text-sm hover:from-green-700 hover:to-emerald-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                        <span>ğŸ“Š</span>
                        ê³ ê° ë³´ê³ ì„œ ìƒì„±
                    </button>
                </div>
                <p class="text-gray-700 leading-relaxed">
                    ë‘ ê°€ì§€ íˆ¬ì í”Œëœì„ ë¹„êµí•˜ê³  ë³µë¦¬ íš¨ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.
                    <span class="font-bold text-blue-700">ì‘ì€ ì´ìœ¨ ì°¨ì´</span>ë„ ì¥ê¸°ì ìœ¼ë¡œëŠ”
                    <span class="font-bold text-purple-700">ì—„ì²­ë‚œ ìì‚° ê²©ì°¨</span>ë¥¼ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤.
                </p>
            </div>

            <!-- ì…ë ¥ ì„¹ì…˜ -->
            <div class="toss-card mb-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-1.5 h-6 bg-gray-900 rounded-full"></div>
                    <h3 class="text-lg font-bold text-gray-900">Simulation Parameters</h3>
                    <span class="text-xs text-gray-400 font-medium ml-auto">ëª¨ë“  ê¸ˆì•¡ ë‹¨ìœ„: ì›(KRW)</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">í˜„ì¬ ë‚˜ì´</label>
                        <div class="relative">
                            <input type="number" id="comp-age" value="35" class="toss-input text-right pr-10">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">ì„¸</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">íˆ¬ì ê¸°ê°„</label>
                        <div class="relative">
                            <input type="number" id="comp-duration" value="30" class="toss-input text-right pr-10">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">ë…„</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">ì˜ˆìƒ ì¢…ë£Œ: <span id="comp-end-age"
                                class="font-bold">65</span>ì„¸</p>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">ì´ˆê¸° íˆ¬ì
                            ì›ê¸ˆ</label>
                        <div class="relative">
                            <input type="text" id="comp-principal" value="50,000,000"
                                class="toss-input text-right pr-10 text-lg font-bold">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 font-bold">ì›</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6 pt-6 border-t">
                    <div class="bg-blue-50 p-5 rounded-xl hover:bg-blue-100 transition-colors border border-blue-100">
                        <div class="flex items-center gap-3 mb-3">
                            <div
                                class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <span class="block text-xs font-bold text-gray-500 uppercase">Plan A</span>
                                <span class="block text-sm font-bold text-blue-900">ë³´ìˆ˜ì  ìš´ìš© (Conservative)</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <input type="number" id="comp-rateA" value="3.5" step="0.1"
                                class="toss-input text-right text-2xl font-bold text-blue-600">
                            <span class="text-xl font-bold text-blue-600">%</span>
                        </div>
                    </div>

                    <div
                        class="bg-amber-50 p-5 rounded-xl hover:bg-amber-100 transition-colors border border-amber-100">
                        <div class="flex items-center gap-3 mb-3">
                            <div
                                class="w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center text-amber-600">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <span class="block text-xs font-bold text-gray-500 uppercase">Plan B</span>
                                <span class="block text-sm font-bold text-amber-900">ì ê·¹ì  ìš´ìš© (Aggressive)</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <input type="number" id="comp-rateB" value="7.0" step="0.1"
                                class="toss-input text-right text-2xl font-bold text-amber-600">
                            <span class="text-xl font-bold text-amber-600">%</span>
                        </div>
                    </div>
                </div>
            </div>


            <!-- ê²°ê³¼ ì¹´ë“œ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="toss-card bg-gradient-to-br from-blue-50 to-white border-blue-100">
                    <span class="text-xs font-bold text-blue-600 uppercase tracking-wider">Plan A</span>
                    <h3 class="text-3xl font-black text-blue-700 mt-2 mb-1 toss-number" id="comp-totalA">0ì›</h3>
                    <p class="text-sm text-gray-600">ì˜ˆìƒ ìµœì¢… ìì‚°</p>
                    <div class="mt-4 pt-4 border-t border-blue-100">
                        <span class="text-xs text-gray-500">ëˆ„ì  ìˆ˜ìµë¥ </span>
                        <p class="text-lg font-bold text-blue-600 mt-1"><span id="comp-accRateA">0</span>%</p>
                    </div>
                </div>

                <div class="toss-card bg-gradient-to-br from-amber-50 to-white border-amber-100">
                    <span class="text-xs font-bold text-amber-600 uppercase tracking-wider">Plan B</span>
                    <h3 class="text-3xl font-black text-amber-700 mt-2 mb-1 toss-number" id="comp-totalB">0ì›
                    </h3>
                    <p class="text-sm text-gray-600">ì˜ˆìƒ ìµœì¢… ìì‚°</p>
                    <div class="mt-4 pt-4 border-t border-amber-100">
                        <span class="text-xs text-gray-500">ëˆ„ì  ìˆ˜ìµë¥ </span>
                        <p class="text-lg font-bold text-amber-600 mt-1"><span id="comp-accRateB">0</span>%</p>
                    </div>
                </div>

                <div class="toss-card bg-gradient-to-br from-gray-900 to-gray-800 text-white">
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">ì°¨ìµ ë¶„ì„</span>
                    <h3 class="text-3xl font-black text-white mt-2 mb-1 toss-number" id="comp-diff">0ì›</h3>
                    <p class="text-sm text-gray-300">Plan B - Plan A</p>
                    <div class="mt-4 pt-4 border-t border-gray-700">
                        <span class="text-xs text-gray-400">ì´ìœ¨ ì°¨ì´</span>
                        <p class="text-lg font-bold text-amber-400 mt-1"><span id="comp-rateDiff">0.0</span>%p
                        </p>
                    </div>
                </div>
            </div>

            <!-- ì°¨íŠ¸ -->
            <div class="toss-card mb-6">
                <!-- ì„íŒ©íŠ¸ ë¬¸êµ¬ -->
                <div class="text-center mb-6 py-4 bg-gradient-to-r from-blue-50 to-amber-50 rounded-xl">
                    <p class="text-xl font-black text-gray-900 leading-relaxed">
                        ê°™ì€ ëˆ, ê°™ì€ ì‹œê°„.<br>
                        <span class="text-blue-600">ë‹¤ë¥¸ ìˆ˜ìµë¥ </span>, <span class="text-amber-600">ì „í˜€ ë‹¤ë¥¸ ë¯¸ë˜</span>
                    </p>
                </div>

                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">Asset Growth Projection</h3>
                        <p class="text-sm text-gray-500 mt-1">ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ìì‚° ê°€ì¹˜ ë³€í™” ë¹„êµ</p>
                    </div>
                    <div class="flex gap-6">
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-blue-500 shadow-sm"></span>
                            <span class="text-xs font-bold text-gray-600">Plan A (ë³´ìˆ˜ì )</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-amber-500 shadow-sm"></span>
                            <span class="text-xs font-bold text-gray-600">Plan B (ì ê·¹ì )</span>
                        </div>
                    </div>
                </div>
                <div class="relative" style="height: 400px;">
                    <canvas id="compChart"></canvas>
                </div>
            </div>

            <!-- ìƒì„¸ í…Œì´ë¸” -->
            <div class="toss-card">
                <h3 class="text-lg font-bold mb-4">ì—°ë„ë³„ ìƒì„¸ ë‚´ì—­</h3>
                <div class="overflow-x-auto">
                    <div class="max-h-96 overflow-y-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr class="text-gray-600">
                                    <th class="py-3 px-4 text-center font-bold">ì—°ë„ / ë‚˜ì´</th>
                                    <th class="py-3 px-4 text-right font-bold text-blue-700">Plan A ìì‚°</th>
                                    <th class="py-3 px-4 text-right text-gray-500">ìˆ˜ìµë¥ </th>
                                    <th class="py-3 px-4 text-right font-bold text-amber-700">Plan B ìì‚°</th>
                                    <th class="py-3 px-4 text-right text-gray-500">ìˆ˜ìµë¥ </th>
                                    <th class="py-3 px-4 text-right font-bold text-gray-900">ì°¨ì•¡</th>
                                </tr>
                            </thead>
                            <tbody id="compTableBody" class="divide-y divide-gray-100">
                                <!-- JSë¡œ ìƒì„± -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 2: ì›” ì €ì¶• ë³µë¦¬ -->
        <div id="tab-monthly-compound" class="tab-content">
            <div class="mb-8 bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-6 border border-green-100">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center text-white shadow-lg">
                            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-2xl font-black text-gray-900">ğŸ“ˆ ë³µë¦¬ì˜ ë§ˆë²•</h2>
                            <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mt-0.5">Monthly
                                Savings
                                Compound Calculator</p>
                        </div>
                    </div>
                    <!-- ë³´ê³ ì„œ ìƒì„± ë²„íŠ¼ -->
                    <button onclick="openReportModal('monthly')"
                        class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-5 py-2.5 rounded-lg font-bold text-sm hover:from-green-700 hover:to-emerald-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                        <span>ğŸ“Š</span>
                        ê³ ê° ë³´ê³ ì„œ ìƒì„±
                    </button>
                </div>
                <p class="text-gray-700 leading-relaxed">
                    "ì§€ê¸ˆ ì“°ëŠ” í‘¼ëˆì´ ë¯¸ë˜ì˜ ëª©ëˆì´ ë©ë‹ˆë‹¤." ë§¤ì›” ì¡°ê¸ˆì”© ì €ì¶•í•˜ë©´ ë³µë¦¬ íš¨ê³¼ë¡œ <span class="font-bold text-green-700">ë†€ë¼ìš´
                        ìì‚°</span>ì„ ë§Œë“¤
                    ìˆ˜ ìˆìŠµë‹ˆë‹¤!
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- ì…ë ¥ ì„¹ì…˜ -->
                <div class="toss-card space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">í˜„ì¬ ë‚˜ì´</label>
                        <div class="relative">
                            <input type="number" id="mc-age" value="45" class="toss-input text-right pr-10">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">ì„¸</span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">ì¬ë¬´ ëª©ì </label>
                        <input type="text" id="mc-goal" placeholder="ì˜ˆ: ë‚´ ì§‘ ë§ˆë ¨, ì„¸ê³„ì¼ì£¼" class="toss-input">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">ì›” ì €ì¶•ì•¡: <span id="mc-save-text"
                                class="text-green-600">300,000ì›</span></label>
                        <input type="range" id="mc-save-range" min="100000" max="5000000" step="50000" value="300000"
                            class="w-full accent-green-600 mb-2">
                        <input type="number" id="mc-save-input" value="300000" class="toss-input text-right">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">ì˜ˆìƒ ìˆ˜ìµë¥ : <span id="mc-rate-text"
                                class="text-blue-600">5%</span></label>
                        <div class="flex items-center gap-2">
                            <input type="range" id="mc-rate" min="1" max="15" step="0.5" value="5"
                                class="w-full accent-blue-600">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">íˆ¬ì ê¸°ê°„: <span id="mc-years-text"
                                class="text-purple-600">10ë…„</span></label>
                        <input type="range" id="mc-years" min="5" max="40" step="1" value="10"
                            class="w-full accent-purple-600">
                        <p id="mc-end-age" class="text-xs text-purple-600 mt-1 text-right font-bold">ì˜ˆìƒ ë§Œê¸° ë‚˜ì´:
                            55ì„¸</p>
                    </div>
                </div>

                <!-- ê²°ê³¼ & ì°¨íŠ¸ -->
                <div class="lg:col-span-2 toss-card bg-gray-50">
                    <div class="relative mb-4" style="height: 320px;">
                        <canvas id="mcChart"></canvas>
                    </div>

                    <div class="grid grid-cols-3 gap-3">
                        <div class="bg-white p-3 rounded-lg border shadow-sm text-center">
                            <p class="text-xs text-gray-500 mb-1">ì´ ë‚©ì… ì›ê¸ˆ</p>
                            <p id="mc-res-principal" class="font-bold text-gray-700 text-sm">0</p>
                        </div>
                        <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 shadow-sm text-center">
                            <p class="text-xs text-blue-600 mb-1">ì´ ì´ì ìˆ˜ìµ</p>
                            <p id="mc-res-interest" class="font-bold text-blue-700 text-sm">+0</p>
                        </div>
                        <div class="bg-indigo-50 p-3 rounded-lg border border-indigo-100 shadow-sm text-center">
                            <p id="mc-res-goal-label" class="text-xs text-indigo-600 mb-1">ìµœì¢… ìì‚°</p>
                            <p id="mc-res-total" class="font-bold text-indigo-700 text-sm">0</p>
                        </div>
                    </div>

                    <div class="mt-4 text-center border-t pt-3">
                        <p class="text-sm text-gray-500">
                            ì´ ìˆ˜ìµë¥ : <span id="mc-res-yield" class="font-bold text-green-600 text-lg">0%</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 3: ê²Œìœ¼ë¦„ ë¹„ìš© -->

        <div id="tab-delay" class="tab-content">
            <div class="mb-6 flex justify-between items-end">
                <div>
                    <h2 class="text-2xl font-black text-gray-900 mb-2">â° ê²Œìœ¼ë¦„ ë¹„ìš©</h2>
                    <p class="text-gray-600">ì˜¤ëŠ˜ì˜ ë§ì„¤ì„ì´ ë¯¸ë˜ì˜ ê°€ì¥ í° ë¹„ìš©ì…ë‹ˆë‹¤</p>
                </div>
                <!-- ë³´ê³ ì„œ ìƒì„± ë²„íŠ¼ -->
                <button onclick="openReportModal('delay')"
                    class="bg-gradient-to-r from-red-500 to-pink-600 text-white px-5 py-2.5 rounded-lg font-bold text-sm hover:from-red-600 hover:to-pink-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                    <span>ğŸ“Š</span>
                    ë¹„ìš© ë¶„ì„ ë³´ê³ ì„œ
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- ì…ë ¥ ì„¹ì…˜ -->
                <div class="toss-card">
                    <h3 class="text-lg font-bold mb-4">ì„¤ì •</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">í˜„ì¬ ë‚˜ì´</label>
                                <div class="relative">
                                    <input type="number" id="delay-age" value="45" class="toss-input text-right pr-10">
                                    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">ì„¸</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">ì¬ë¬´ ëª©ì </label>
                                <input type="text" id="delay-goal" placeholder="ì˜ˆ: ì€í‡´ ìê¸ˆ" class="toss-input">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ëª©í‘œ ê¸ˆì•¡</label>
                            <div class="relative">
                                <input type="number" id="delay-amount" value="100000000"
                                    class="toss-input text-right pr-10 text-lg font-bold">
                                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">ì›</span>
                            </div>
                            <div class="flex gap-2 mt-2">
                                <button onclick="setDelayAmount(50000000)"
                                    class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-lg">5ì²œë§Œ</button>
                                <button onclick="setDelayAmount(100000000)"
                                    class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-lg">1ì–µ</button>
                                <button onclick="setDelayAmount(300000000)"
                                    class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-lg">3ì–µ</button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ì´ ì¤€ë¹„ ê¸°ê°„: <span
                                    id="delay-years-text" class="text-blue-600">20ë…„</span></label>
                            <input type="range" id="delay-years" min="1" max="50" value="20"
                                class="w-full accent-blue-600">
                            <p class="text-xs text-gray-500 mt-1">ëª©í‘œ ë‹¬ì„± ë‚˜ì´: <span id="delay-end-age"
                                    class="font-bold">65</span>ì„¸</p>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ì§€ì—° ê¸°ê°„: <span
                                    id="delay-delay-text" class="text-red-600">5ë…„ ë’¤ ì‹œì‘</span></label>
                            <input type="range" id="delay-delay" min="1" max="19" value="5"
                                class="w-full accent-red-600">
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ìˆ˜ìµë¥ : <span
                                    id="delay-rate-text" class="text-green-600">6%</span></label>
                            <input type="range" id="delay-rate" min="2" max="10" step="0.5" value="6"
                                class="w-full accent-green-600 ">
                        </div>
                    </div>
                </div>

                <!-- ê²°ê³¼ ë¹„êµ -->
                <div class="space-y-4">
                    <div class="toss-card bg-gradient-to-br from-blue-50 to-white border-blue-100">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-bold text-blue-900">âœ… ì§€ê¸ˆ (<span id="delay-now-age">45</span>ì„¸) ì‹œì‘í•˜ë©´
                            </h4>
                            <span class="text-xs bg-blue-200 text-blue-800 px-2 py-1 rounded font-bold">BEST</span>
                        </div>
                        <div class="mb-4">
                            <p class="text-sm text-gray-600 mb-1">ì›” ì €ì¶•ì•¡ (<span id="delay-now-years">20</span>ë…„)
                            </p>
                            <p class="text-3xl font-black text-blue-700 toss-number" id="delay-now-monthly">0ì›
                            </p>
                        </div>
                        <div class="pt-3 border-t border-blue-100">
                            <p class="text-xs text-gray-500">ì´ ë¶ˆì…ì›ê¸ˆ</p>
                            <p class="text-lg font-bold text-blue-600" id="delay-now-total">0ì›</p>
                        </div>
                    </div>

                    <div class="toss-card bg-gradient-to-br from-red-50 to-white border-red-100">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-bold text-red-900">âš ï¸ <span id="delay-delay-years">5</span>ë…„ ë’¤
                                (<span id="delay-delay-age">50</span>ì„¸) ì‹œì‘í•˜ë©´</h4>
                            <span class="text-xs bg-red-200 text-red-800 px-2 py-1 rounded font-bold">WARNING</span>
                        </div>
                        <div class="mb-4">
                            <p class="text-sm text-gray-600 mb-1">ì›” ì €ì¶•ì•¡ (<span id="delay-remain-years">15</span>ë…„)
                            </p>
                            <p class="text-3xl font-black text-red-700 toss-number" id="delay-delay-monthly">0ì›
                            </p>
                        </div>
                        <div class="pt-3 border-t border-red-100">
                            <p class="text-xs text-gray-500">ì´ ë¶ˆì…ì›ê¸ˆ</p>
                            <p class="text-lg font-bold text-red-600" id="delay-delay-total">0ì›</p>
                        </div>
                    </div>

                    <div class="toss-card bg-gradient-to-br from-gray-900 to-gray-800 text-white text-center py-8">
                        <p class="text-sm text-gray-400 mb-2">ê²Œìœ¼ë¦„ ë¹„ìš© (<span id="delay-val">5</span>ë…„ ì§€ì—°)</p>
                        <p class="text-4xl font-black text-yellow-400 toss-number mb-2" id="delay-cost">0ì›</p>
                        <p class="text-xs text-gray-400">ë” ë‚´ì•¼ í•˜ëŠ” ëˆ</p>
                    </div>
                </div>
            </div>
        </div>


        <!-- Tab 3: ì€í‡´ ì„¤ê³„ -->
        <!-- Tab 3: ì€í‡´ ì„¤ê³„ (í™©ê¸ˆ ê±°ìœ„) -->
        <div id="tab-retirement" class="tab-content active">
            <div class="mb-6 flex justify-between items-end">
                <div>
                    <h2 class="text-2xl font-black text-gray-900 mb-2">ğŸ¯ í™©ê¸ˆ ê±°ìœ„ ë§Œë“¤ê¸°</h2>
                    <p class="text-gray-600">ì›ê¸ˆì€ ì§€í‚¤ê³  ë°°ë‹¹ìœ¼ë¡œë§Œ í‰ìƒ ì›”ê¸‰ ë°›ê¸° (ì—° 7% ë°°ë‹¹ ê¸°ì¤€)</p>
                </div>
                <!-- ë³´ê³ ì„œ ìƒì„± ë²„íŠ¼ -->
                <button onclick="openReportModal('retirement')"
                    class="bg-gradient-to-r from-amber-500 to-orange-600 text-white px-5 py-2.5 rounded-lg font-bold text-sm hover:from-amber-600 hover:to-orange-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                    <span>ğŸ“Š</span>
                    ì€í‡´ í”Œëœ ë³´ê³ ì„œ
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- ì…ë ¥ ì„¹ì…˜ -->
                <div class="space-y-6">
                    <!-- 1. ì€í‡´ ëª©í‘œ ì„¤ì • -->
                    <div class="toss-card border-l-4 border-blue-500">
                        <div class="flex items-center gap-2 mb-3">
                            <div
                                class="w-6 h-6 bg-blue-500 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                                1</div>
                            <h3 class="text-lg font-bold text-gray-900">ì€í‡´ ëª©í‘œ ì„¤ì •</h3>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-3">
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <label class="block text-xs font-semibold text-gray-500 mb-1">í˜„ì¬ ë‚˜ì´</label>
                                <input type="number" id="ret-age" value="40"
                                    class="toss-input text-center text-lg font-bold">
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <label class="block text-xs font-semibold text-gray-500 mb-1">ì€í‡´ ë‚˜ì´</label>
                                <input type="number" id="ret-retire-age" value="65"
                                    class="toss-input text-center text-lg font-bold">
                            </div>
                        </div>

                        <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                            <label class="block text-xs font-bold text-blue-900 mb-2">ğŸ’° í¬ë§ ì›” ìˆ˜ë ¹ì•¡</label>
                            <div class="relative">
                                <input type="number" id="ret-pension" value="3000000" step="100000"
                                    class="toss-input text-right pr-10 text-xl font-bold text-blue-700 bg-white">
                                <span
                                    class="absolute right-3 top-1/2 -translate-y-1/2 text-sm font-bold text-gray-500">ì›</span>
                            </div>
                        </div>

                        <div class="mt-3 bg-gradient-to-r from-blue-500 to-indigo-600 p-4 rounded-xl text-center">
                            <p class="text-xs text-white/80 mb-1 font-semibold">ë°°ë‹¹ë¥  7% ê¸°ì¤€ í•„ìš” ëª©ëˆ</p>
                            <p class="text-2xl font-black text-white toss-number" id="ret-target">0ì›</p>
                        </div>
                    </div>

                    <!-- 2. ì €ì¶• & ì¦ì‹ í”Œëœ -->
                    <div class="toss-card border-l-4 border-green-500">
                        <div class="flex items-center gap-2 mb-3">
                            <div
                                class="w-6 h-6 bg-green-500 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                                2</div>
                            <h3 class="text-lg font-bold text-gray-900">ì €ì¶• & ì¦ì‹ í”Œëœ</h3>
                        </div>

                        <div class="mb-4 pb-4 border-b border-gray-200">
                            <div class="flex justify-between items-center mb-2">
                                <label class="font-bold text-sm text-green-700 flex items-center gap-1">
                                    <span class="text-lg">ğŸŒ±</span>
                                    A. ëª¨ìœ¼ëŠ” ê¸°ê°„
                                </label>
                                <span id="ret-save-badge"
                                    class="text-xs font-bold bg-green-100 text-green-800 px-2 py-1 rounded">10ë…„</span>
                            </div>
                            <input type="range" id="ret-save-years" min="1" max="30" value="10"
                                class="w-full h-2 accent-green-600 mb-2">
                            <div class="bg-green-50 p-2 rounded flex items-center justify-between">
                                <span class="text-xs font-semibold text-gray-700">ê¸°ëŒ€ ìˆ˜ìµë¥ </span>
                                <div class="flex items-center gap-1">
                                    <input type="number" id="ret-save-rate" value="5"
                                        class="w-16 p-1 border border-green-300 rounded text-right text-sm font-bold">
                                    <span class="text-sm font-bold text-green-700">%</span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label class="font-bold text-sm text-purple-700 flex items-center gap-1">
                                    <span class="text-lg">ğŸš€</span>
                                    B. ë¶ˆë¦¬ëŠ” ê¸°ê°„
                                </label>
                                <span id="ret-defer-badge"
                                    class="text-xs font-bold bg-purple-100 text-purple-800 px-2 py-1 rounded">15ë…„</span>
                            </div>
                            <input type="range" id="ret-defer-years" min="0" max="30" value="15"
                                class="w-full h-2 accent-purple-600 mb-2">
                            <div class="bg-purple-50 p-2 rounded flex items-center justify-between">
                                <span class="text-xs font-semibold text-gray-700">ê¸°ëŒ€ ìˆ˜ìµë¥ </span>
                                <div class="flex items-center gap-1">
                                    <input type="number" id="ret-defer-rate" value="5"
                                        class="w-16 p-1 border border-purple-300 rounded text-right text-sm font-bold">
                                    <span class="text-sm font-bold text-purple-700">%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ê²°ê³¼ ì„¹ì…˜ -->
                <div
                    class="toss-card bg-gradient-to-br from-gray-900 to-gray-800 text-white flex flex-col justify-center p-5">
                    <h4 class="text-gray-300 text-xs font-medium mb-4 text-center uppercase">ëª©í‘œ ë‹¬ì„± ì „ëµ</h4>

                    <div class="mb-6 text-center bg-black/30 rounded-xl p-4 border border-yellow-500/30">
                        <p class="text-yellow-300 text-xs font-semibold mb-1">ğŸ’µ ë§¤ì›” ì´ë§Œí¼ë§Œ ì €ì¶•í•˜ì„¸ìš”!</p>
                        <span id="ret-monthly"
                            class="text-4xl md:text-5xl font-black text-yellow-400 toss-number block">0ì›</span>
                        <p class="text-gray-400 mt-2 text-xs"><span id="ret-save-text">10</span>ë…„ ë™ì•ˆ ë§¤ì›” ë‚©ì… ì‹œ</p>
                    </div>

                    <div class="bg-gray-800 rounded-lg p-4 text-sm space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="flex items-center gap-2 font-bold text-green-400 text-sm">
                                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                                <span>1ë‹¨ê³„: ëª©ëˆ ë§Œë“¤ê¸°</span>
                            </span>
                            <span id="ret-fv-save" class="text-white font-bold text-sm">0 ë‹¬ì„±</span>
                        </div>

                        <div id="ret-step-2" class="flex justify-between items-center">
                            <span class="flex items-center gap-2 font-bold text-purple-400 text-sm">
                                <div class="w-3 h-3 rounded-full bg-purple-500"></div>
                                <span>2ë‹¨ê³„: êµ´ë¦¬ê¸°</span>
                            </span>
                            <span id="ret-target-2" class="text-white font-bold text-sm">0 ë‹¬ì„±</span>
                        </div>

                        <div class="flex justify-between items-center border-t border-gray-700 pt-3">
                            <span class="flex items-center gap-2 font-bold text-blue-400 text-sm">
                                <div class="w-3 h-3 rounded-full bg-blue-500"></div> 3ë‹¨ê³„: í‰ìƒ ì›”ê¸‰
                            </span>
                            <span id="ret-pension-result" class="text-yellow-400 font-bold text-sm">ë§¤ì›” 0</span>
                        </div>
                    </div>

                    <div id="ret-alert"
                        class="mt-3 flex items-center gap-2 text-orange-400 text-xs bg-orange-400/10 px-3 py-2 rounded-lg hidden">
                        âš ï¸ ì£¼ì˜: ê¸°ê°„ í•©ê³„ê°€ ì€í‡´ê¹Œì§€ ë‚¨ì€ ì‹œê°„ê³¼ ë‹¤ë¦…ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 4: ìƒì• ì£¼ê¸° -->
        <div id="tab-lifecycle" class="tab-content">
            <div class="mb-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 border border-purple-100">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center text-white shadow-lg">
                            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-2xl font-black text-gray-900">ğŸ“… ë¼ì´í”„ ì‚¬ì´í´</h2>
                            <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mt-0.5">Life
                                Cycle
                                Financial Planner</p>
                        </div>
                    </div>
                    <!-- ë³´ê³ ì„œ ìƒì„± ë²„íŠ¼ -->
                    <button onclick="openReportModal('lifecycle')"
                        class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-5 py-2.5 rounded-lg font-bold text-sm hover:from-purple-700 hover:to-indigo-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                        <span>ğŸ“Š</span>
                        ìƒì•  ë³´ê³ ì„œ ìƒì„±
                    </button>
                </div>
                <p class="text-gray-700 leading-relaxed">
                    ì¸ìƒì˜ ê° ë‹¨ê³„ë³„ ì¬ë¬´ ëª©í‘œë¥¼ ì„¤ì •í•˜ê³  íƒ€ì„ë¼ì¸ìœ¼ë¡œ ì‹œê°í™”í•˜ì„¸ìš”.
                </p>
            </div>

            <!-- iframe Container -->
            <div class="toss-card p-0 overflow-hidden" style="height: calc(100vh - 300px); min-height: 600px;">
                <iframe id="iframe-lifecycle" src="life_cycle.html" class="w-full h-full border-0" title="ìƒì• ì£¼ê¸° í”Œë˜ë„ˆ"
                    loading="lazy">
                </iframe>
            </div>
        </div>

        <!-- Tab 5: ì€í‡´ ì¸ì¶œ -->
        <div id="tab-withdrawal" class="tab-content">
            <div class="mb-6 bg-gradient-to-r from-cyan-50 to-blue-50 rounded-2xl p-6 border border-cyan-100">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-12 h-12 bg-cyan-600 rounded-xl flex items-center justify-center text-white shadow-lg">
                            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                                </path>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-2xl font-black text-gray-900">ğŸ’³ ì€í‡´ ì„¤ê³„</h2>
                            <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider mt-0.5">
                                Retirement
                                Withdrawal Simulator</p>
                        </div>
                    </div>
                    <!-- ë³´ê³ ì„œ ìƒì„± ë²„íŠ¼ -->
                    <button onclick="openReportModal('withdrawal')"
                        class="bg-gradient-to-r from-cyan-600 to-blue-600 text-white px-5 py-2.5 rounded-lg font-bold text-sm hover:from-cyan-700 hover:to-blue-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                        <span>ğŸ“Š</span>
                        ì¸ì¶œ ë³´ê³ ì„œ ìƒì„±
                    </button>
                </div>
                <p class="text-gray-700 leading-relaxed">
                    ì¤€ë¹„ëœ ì€í‡´ ìê¸ˆìœ¼ë¡œ ë‚˜ì´ëŒ€ë³„ ì‹¤ì œ ìˆ˜ë ¹ì•¡ê³¼ ì‹¤ì§ˆ ê°€ì¹˜ë¥¼ ë¯¸ë¦¬ í™•ì¸í•˜ì„¸ìš”.
                </p>
            </div>

            <!-- iframe Container -->
            <div class="toss-card p-0 overflow-hidden" style="height: calc(100vh - 300px); min-height: 600px;">
                <iframe id="iframe-withdrawal" src="retirement_withdrawal.html" class="w-full h-full border-0"
                    title="ì€í‡´ ì¸ì¶œ ì‹œë®¬ë ˆì´í„°">
                </iframe>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 py-12 mt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h3 class="text-white font-bold text-lg mb-2">ì¬ë¬´ì„¤ê³„ ë§ˆìŠ¤í„°</h3>
            <p class="text-sm mb-4">ëª¨ë“  ì¬ë¬´ ê³„ì‚°ì„ í•œ ê³³ì—ì„œ ê°„í¸í•˜ê²Œ</p>
            <p class="text-xs text-gray-500">ë³¸ ê³„ì‚° ê²°ê³¼ëŠ” ì˜ˆì‹œì´ë©° ì‹¤ì œ íˆ¬ì ìˆ˜ìµì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
            <p class="text-xs text-gray-600 mt-6">Â© 2024-2026 ê¸ˆì‡¼ë§˜ì˜ ê¸ˆìœµìŠ¤ì¿¨. All rights reserved.</p>
        </div>
    </footer>

    <!-- ê³ ê° ì •ë³´ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="reportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50"
        style="display: none;">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8">
            <h2 class="text-2xl font-black text-gray-900 mb-6">ğŸ“‹ ê³ ê° ì •ë³´ ì…ë ¥</h2>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">ê³ ê°ëª… *</label>
                    <input type="text" id="modal-client-name" placeholder="í™ê¸¸ë™"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">ë‚˜ì´ *</label>
                    <input type="number" id="modal-client-age" placeholder="45"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">ë¶„ì„ ëª©ì </label>
                    <input type="text" id="modal-analysis-purpose" placeholder="ì˜ˆ: ì€í‡´ ìê¸ˆ ë§ˆë ¨, ìì‚° ì„±ì¥"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                </div>
            </div>

            <div class="flex gap-3 mt-8">
                <button onclick="closeReportModal()"
                    class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300 transition">
                    ì·¨ì†Œ
                </button>
                <button onclick="generateReport()"
                    class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-lg font-bold hover:from-blue-700 hover:to-blue-600 transition">
                    ë³´ê³ ì„œ ìƒì„±
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== íƒ­ ì „í™˜ =====
        function switchTab(tabName, event) {
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');

            // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-600', 'text-white', 'shadow-lg');
                btn.classList.add('bg-gray-100', 'text-gray-600');
            });

            // currentTargetì„ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ë²„íŠ¼ ìš”ì†Œë¥¼ ê°€ì ¸ì˜´ (span í´ë¦­ ì‹œì—ë„ ì‘ë™)
            const clickedBtn = event.currentTarget;
            clickedBtn.classList.remove('bg-gray-100', 'text-gray-600');
            clickedBtn.classList.add('active', 'bg-blue-600', 'text-white', 'shadow-lg');
        }

        // ===== ë³µë¦¬ ê³„ì‚°ê¸° =====
        const compState = {
            age: 35,
            duration: 30,
            principal: 50000000,
            rateA: 3.5,
            rateB: 7.0,
            data: []
        };

        const compEls = {
            age: document.getElementById('comp-age'),
            duration: document.getElementById('comp-duration'),
            principal: document.getElementById('comp-principal'),
            rateA: document.getElementById('comp-rateA'),
            rateB: document.getElementById('comp-rateB'),
            endAge: document.getElementById('comp-end-age'),
            totalA: document.getElementById('comp-totalA'),
            accRateA: document.getElementById('comp-accRateA'),
            totalB: document.getElementById('comp-totalB'),
            accRateB: document.getElementById('comp-accRateB'),
            diff: document.getElementById('comp-diff'),
            rateDiff: document.getElementById('comp-rateDiff'),
            tableBody: document.getElementById('compTableBody'),
            canvas: document.getElementById('compChart')
        };

        let compChart = null;

        const formatMoney = (n) => new Intl.NumberFormat('ko-KR').format(Math.round(n));
        const parseMoney = (s) => parseInt(s.replace(/[^0-9]/g, '')) || 0;

        function calculateCompound() {
            compState.data = [];
            const { principal, rateA, rateB, duration, age } = compState;

            compEls.endAge.textContent = age + duration;
            compEls.rateDiff.textContent = Math.abs(rateB - rateA).toFixed(1);

            for (let i = 1; i <= duration; i++) {
                const totalA = principal * Math.pow((1 + rateA / 100), i);
                const totalB = principal * Math.pow((1 + rateB / 100), i);

                compState.data.push({
                    year: i,
                    currentAge: age + i,
                    totalA,
                    totalB,
                    accRateA: (totalA / principal) * 100,
                    accRateB: (totalB / principal) * 100,
                    diff: totalB - totalA
                });
            }

            updateCompoundUI();
        }

        function updateCompoundUI() {
            if (compState.data.length === 0) return;
            const final = compState.data[compState.data.length - 1];

            compEls.totalA.textContent = formatMoney(final.totalA) + 'ì›';
            compEls.accRateA.textContent = final.accRateA.toFixed(0);

            compEls.totalB.textContent = formatMoney(final.totalB) + 'ì›';
            compEls.accRateB.textContent = final.accRateB.toFixed(0);

            compEls.diff.textContent = formatMoney(Math.abs(final.diff)) + 'ì›';

            renderCompoundTable();
            updateCompoundChart();
        }

        function renderCompoundTable() {
            compEls.tableBody.innerHTML = '';

            // ì‹œì‘ í–‰
            const startRow = `
                <tr class="text-gray-400 italic">
                    <td class="py-3 px-4 text-center">ì‹œì‘ (${compState.age}ì„¸)</td>
                    <td class="py-3 px-4 text-right">${formatMoney(compState.principal)}</td>
                    <td class="py-3 px-4 text-right">100%</td>
                    <td class="py-3 px-4 text-right">${formatMoney(compState.principal)}</td>
                    <td class="py-3 px-4 text-right">100%</td>
                    <td class="py-3 px-4 text-right">-</td>
                </tr>
            `;
            compEls.tableBody.insertAdjacentHTML('beforeend', startRow);

            compState.data.forEach((d, idx) => {
                const isMilestone = d.year % 5 === 0;
                const rowClass = isMilestone ? 'bg-blue-50 font-semibold' : 'hover:bg-gray-50';

                const row = `
                    <tr class="${rowClass}">
                        <td class="py-3 px-4 text-center">
                            <span class="text-gray-500">${d.year}ë…„ í›„</span>
                            <span class="ml-2 bg-gray-100 px-2 py-1 rounded font-semibold">${d.currentAge}ì„¸</span>
                        </td>
                        <td class="py-3 px-4 text-right text-blue-700 font-semibold">${formatMoney(d.totalA)}</td>
                        <td class="py-3 px-4 text-right text-gray-500">${d.accRateA.toFixed(0)}%</td>
                        <td class="py-3 px-4 text-right text-amber-700 font-semibold">${formatMoney(d.totalB)}</td>
                        <td class="py-3 px-4 text-right text-gray-500">${d.accRateB.toFixed(0)}%</td>
                        <td class="py-3 px-4 text-right font-bold text-gray-900">+${formatMoney(d.diff)}</td>
                    </tr>
                `;
                compEls.tableBody.insertAdjacentHTML('beforeend', row);
            });
        }

        function updateCompoundChart() {
            const ctx = compEls.canvas.getContext('2d');

            if (compChart) compChart.destroy();

            compChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: compState.data.map(d => d.year + 'ë…„'),
                    datasets: [
                        {
                            label: 'Plan A (ë³´ìˆ˜ì )',
                            data: compState.data.map(d => d.totalA),
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Plan B (ì ê·¹ì )',
                            data: compState.data.map(d => d.totalB),
                            borderColor: '#d97706',
                            backgroundColor: 'rgba(217, 119, 6, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: { size: 14, weight: 'bold' },
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#191F28',
                            bodyColor: '#4E5968',
                            borderColor: '#e2e8f0',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: (ctx) => ' ' + ctx.dataset.label + ': ' + formatMoney(ctx.parsed.y) + 'ì›'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 11 } }
                        },
                        y: {
                            grid: { color: '#f1f5f9' },
                            ticks: {
                                callback: (value) => {
                                    if (value >= 100000000) return (value / 100000000).toFixed(0) + 'ì–µ';
                                    if (value >= 10000) return (value / 10000).toFixed(0) + 'ë§Œ';
                                    return value;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        compEls.principal.addEventListener('input', (e) => {
            const v = parseMoney(e.target.value);
            if (!isNaN(v)) { compState.principal = v; calculateCompound(); }
        });
        compEls.principal.addEventListener('blur', (e) => {
            e.target.value = formatMoney(compState.principal);
        });

        ['age', 'duration'].forEach(key => {
            compEls[key].addEventListener('input', (e) => {
                let v = parseInt(e.target.value) || 0;
                if (v < 0) v = 0;
                compState[key] = v;
                calculateCompound();
            });
        });

        ['rateA', 'rateB'].forEach(key => {
            compEls[key].addEventListener('input', (e) => {
                let v = parseFloat(e.target.value) || 0;
                if (v < 0) v = 0;
                compState[key] = v;
                calculateCompound();
            });
        });

        // ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            compEls.principal.value = formatMoney(compState.principal);
            calculateCompound();
            calculateDelay(); // ê²Œìœ¼ë¦„ ë¹„ìš© ì´ˆê¸°í™”
            updateMonthlyCompound(); // ì›” ì €ì¶• ë³µë¦¬ ì´ˆê¸°í™”
        });

        // =================================================================
        // 2. ì›” ì €ì¶• ë³µë¦¬ ê³„ì‚°ê¸° (Monthly Compound Calculator)
        // =================================================================
        const mcEls = {
            age: document.getElementById('mc-age'),
            goal: document.getElementById('mc-goal'),
            saveRange: document.getElementById('mc-save-range'),
            saveInput: document.getElementById('mc-save-input'),
            saveText: document.getElementById('mc-save-text'),
            rate: document.getElementById('mc-rate'),
            rateText: document.getElementById('mc-rate-text'),
            years: document.getElementById('mc-years'),
            yearsText: document.getElementById('mc-years-text'),
            endAge: document.getElementById('mc-end-age'),
            resPrincipal: document.getElementById('mc-res-principal'),
            resInterest: document.getElementById('mc-res-interest'),
            resGoalLabel: document.getElementById('mc-res-goal-label'),
            resTotal: document.getElementById('mc-res-total'),
            resYield: document.getElementById('mc-res-yield'),
            canvas: document.getElementById('mcChart')
        };

        let mcChart = null;

        function updateMonthlyCompound() {
            const age = Number(mcEls.age.value);
            const save = Number(mcEls.saveInput.value);
            const rate = Number(mcEls.rate.value);
            const years = Number(mcEls.years.value);
            const goalName = mcEls.goal.value;

            // Sync inputs
            mcEls.saveRange.value = save;
            mcEls.saveText.textContent = formatMoney(save) + 'ì›';
            mcEls.rateText.textContent = rate + '%';
            mcEls.yearsText.textContent = years + 'ë…„';
            mcEls.endAge.textContent = `ì˜ˆìƒ ë§Œê¸° ë‚˜ì´: ${age + years}ì„¸`;

            // Calculate FV with monthly contributions (Future Value of Annuity)
            const data = [];
            for (let i = 1; i <= years; i++) {
                const monthlyRate = rate / 100 / 12;
                const months = i * 12;
                const fv = save * ((Math.pow(1 + monthlyRate, months) - 1) / monthlyRate);
                const principal = save * 12 * i;
                data.push({
                    age: age + i,
                    year: i,
                    principal: Math.round(principal),
                    total: Math.round(fv),
                    interest: Math.round(fv - principal)
                });
            }

            const final = data[data.length - 1] || { principal: 0, total: 0, interest: 0 };
            mcEls.resPrincipal.textContent = formatMoney(final.principal);
            mcEls.resInterest.textContent = '+' + formatMoney(final.interest);
            mcEls.resTotal.textContent = formatMoney(final.total);
            const yieldPercent = final.principal > 0 ? ((final.interest / final.principal) * 100).toFixed(1) : 0;
            mcEls.resYield.textContent = yieldPercent + '%';

            if (goalName.trim()) {
                mcEls.resGoalLabel.textContent = goalName + ' ë‹¬ì„± ê¸ˆì•¡';
            } else {
                mcEls.resGoalLabel.textContent = 'ìµœì¢… ìì‚°';
            }

            // Update Chart
            updateMCChart(data);
        }

        function updateMCChart(data) {
            if (mcChart) mcChart.destroy();

            const ctx = mcEls.canvas.getContext('2d');
            mcChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.year + 'ë…„ì°¨'),
                    datasets: [
                        {
                            label: 'ì´ ë‚©ì… ì›ê¸ˆ',
                            data: data.map(d => d.principal),
                            borderColor: '#94a3b8',
                            backgroundColor: 'rgba(148, 163, 184, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        },
                        {
                            label: 'ìµœì¢… ìì‚° (ë³µë¦¬ í¬í•¨)',
                            data: data.map(d => d.total),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    return context.dataset.label + ': ' + formatMoney(context.parsed.y) + 'ì›';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: (value) => formatMoney(value) + 'ì›'
                            }
                        }
                    }
                }
            });
        }

        // Event listeners for Monthly Compound
        mcEls.age.addEventListener('input', updateMonthlyCompound);
        mcEls.goal.addEventListener('input', updateMonthlyCompound);
        mcEls.saveRange.addEventListener('input', () => {
            mcEls.saveInput.value = mcEls.saveRange.value;
            updateMonthlyCompound();
        });
        mcEls.saveInput.addEventListener('input', updateMonthlyCompound);
        mcEls.rate.addEventListener('input', updateMonthlyCompound);
        mcEls.years.addEventListener('input', updateMonthlyCompound);

        // =================================================================

        const delayEls = {
            age: document.getElementById('delay-age'),
            goal: document.getElementById('delay-goal'),
            amount: document.getElementById('delay-amount'),
            years: document.getElementById('delay-years'),
            yearsText: document.getElementById('delay-years-text'),
            endAge: document.getElementById('delay-end-age'),
            delay: document.getElementById('delay-delay'),
            delayText: document.getElementById('delay-delay-text'),
            rate: document.getElementById('delay-rate'),
            rateText: document.getElementById('delay-rate-text'),
            nowAge: document.getElementById('delay-now-age'),
            nowYears: document.getElementById('delay-now-years'),
            nowMonthly: document.getElementById('delay-now-monthly'),
            nowTotal: document.getElementById('delay-now-total'),
            delayYears: document.getElementById('delay-delay-years'),
            delayAge: document.getElementById('delay-delay-age'),
            remainYears: document.getElementById('delay-remain-years'),
            delayMonthly: document.getElementById('delay-delay-monthly'),
            delayTotal: document.getElementById('delay-delay-total'),
            delayVal: document.getElementById('delay-val'),
            cost: document.getElementById('delay-cost')
        };

        function setDelayAmount(val) {
            delayEls.amount.value = val;
            calculateDelay();
        }

        function calculatePMT(target, r, n) {
            if (n <= 0) return 0;
            const monthlyRate = r / 100 / 12;
            const months = n * 12;
            const factor = ((Math.pow(1 + monthlyRate, months) - 1) / monthlyRate);
            return target / factor;
        }

        function calculateDelay() {
            const age = Number(delayEls.age.value) || 45;
            const goalAmount = Number(delayEls.amount.value) || 100000000;
            const years = Number(delayEls.years.value) || 20;
            const rate = Number(delayEls.rate.value) || 6;
            let delay = Number(delayEls.delay.value) || 5;

            // ì§€ì—° ì œí•œ
            if (delay >= years) {
                delay = years - 1;
                delayEls.delay.value = delay;
            }

            delayEls.yearsText.textContent = years + 'ë…„';
            delayEls.endAge.textContent = age + years;
            delayEls.delayText.textContent = delay + 'ë…„ ë’¤ ì‹œì‘';
            delayEls.rateText.textContent = rate + '%';

            // ê³„ì‚°
            const nowPayment = calculatePMT(goalAmount, rate, years);
            const remainingYears = years - delay;
            const delayedPayment = calculatePMT(goalAmount, rate, remainingYears);

            const totalCostNow = nowPayment * 12 * years;
            const totalCostDelayed = delayedPayment * 12 * remainingYears;
            const lostMoney = totalCostDelayed - totalCostNow;

            // ë Œë”ë§
            delayEls.nowAge.textContent = age;
            delayEls.nowYears.textContent = years;
            delayEls.nowMonthly.textContent = formatMoney(nowPayment) + 'ì›';
            delayEls.nowTotal.textContent = formatMoney(totalCostNow) + 'ì›';

            delayEls.delayYears.textContent = delay;
            delayEls.delayAge.textContent = age + delay;
            delayEls.remainYears.textContent = remainingYears;
            delayEls.delayMonthly.textContent = formatMoney(delayedPayment) + 'ì›';
            delayEls.delayTotal.textContent = formatMoney(totalCostDelayed) + 'ì›';

            delayEls.delayVal.textContent = delay;
            delayEls.cost.textContent = formatMoney(lostMoney) + 'ì›';
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        ['age', 'goal', 'amount', 'years', 'delay', 'rate'].forEach(key => {
            if (delayEls[key]) {
                delayEls[key].addEventListener('input', calculateDelay);
            }
        });

        //  ===== ì€í‡´ ì„¤ê³„ ê³„ì‚°ê¸° =====
        const retEls = {
            age: document.getElementById('ret-age'),
            retireAge: document.getElementById('ret-retire-age'),
            pension: document.getElementById('ret-pension'),
            target: document.getElementById('ret-target'),
            saveYears: document.getElementById('ret-save-years'),
            saveBadge: document.getElementById('ret-save-badge'),
            saveRate: document.getElementById('ret-save-rate'),
            deferYears: document.getElementById('ret-defer-years'),
            deferBadge: document.getElementById('ret-defer-badge'),
            deferRate: document.getElementById('ret-defer-rate'),
            monthly: document.getElementById('ret-monthly'),
            saveText: document.getElementById('ret-save-text'),
            fvSave: document.getElementById('ret-fv-save'),
            target2: document.getElementById('ret-target-2'),
            pensionResult: document.getElementById('ret-pension-result'),
            step2: document.getElementById('ret-step-2'),
            alert: document.getElementById('ret-alert')
        };

        const DIVIDEND_RATE = 7;

        function calculateRetirement() {
            const age = Number(retEls.age.value) || 40;
            const retireAge = Number(retEls.retireAge.value) || 65;
            const monthlyPension = Number(retEls.pension.value) || 3000000;
            const saveYears = Number(retEls.saveYears.value) || 10;
            const saveRate = Number(retEls.saveRate.value) || 5;
            const deferYears = Number(retEls.deferYears.value) || 15;
            const deferRate = Number(retEls.deferRate.value) || 5;

            // ë°°ì§€ ì—…ë°ì´íŠ¸
            retEls.saveBadge.textContent = saveYears + 'ë…„';
            retEls.deferBadge.textContent = deferYears + 'ë…„';

            // ëª©í‘œ ê¸ˆì•¡ ê³„ì‚°
            const targetCorpus = (monthlyPension * 12) / (DIVIDEND_RATE / 100);
            retEls.target.textContent = formatMoney(targetCorpus) + 'ì›';

            // ê±°ì¹˜ í›„ í•„ìš”í•œ ê¸ˆì•¡
            const requiredFVSave = targetCorpus / Math.pow(1 + deferRate / 100, deferYears);

            // ì›” ì €ì¶•ì•¡
            const monthlyRate = saveRate / 100 / 12;
            const totalMonths = saveYears * 12;
            const factor = (Math.pow(1 + monthlyRate, totalMonths) - 1) / monthlyRate;
            const requiredMonthlySave = requiredFVSave / factor;

            // ê²°ê³¼ ë Œë”ë§
            retEls.monthly.textContent = formatMoney(requiredMonthlySave) + 'ì›';
            retEls.saveText.textContent = saveYears;
            retEls.fvSave.textContent = formatMoney(requiredFVSave) + ' ë‹¬ì„±';
            retEls.target2.textContent = formatMoney(targetCorpus) + ' ë‹¬ì„±';
            retEls.pensionResult.textContent = 'ë§¤ì›” ' + formatMoney(monthlyPension);

            // 2ë‹¨ê³„ í‘œì‹œ ìœ ë¬´
            if (deferYears > 0) {
                retEls.step2.style.display = 'flex';
            } else {
                retEls.step2.style.display = 'none';
            }

            // ê²½ê³  ë©”ì‹œì§€
            const totalPlanYears = saveYears + deferYears;
            const yearsUntilRetire = retireAge - age;
            if (totalPlanYears !== yearsUntilRetire) {
                retEls.alert.classList.remove('hidden');
            } else {
                retEls.alert.classList.add('hidden');
            }
        }

        // ì€í‡´ ì„¤ê³„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        Object.values(retEls).forEach(el => {
            if (el && el.addEventListener) el.addEventListener('input', calculateRetirement);
        });


        // ì€í‡´ ì„¤ê³„ ì´ˆê¸°í™” ì¶”ê°€
        window.addEventListener('DOMContentLoaded', () => {
            calculateRetirement();
        });


        // =================================================================
        // ê³ ê° ë³´ê³ ì„œ ìƒì„± ê¸°ëŠ¥
        // =================================================================


        let currentReportType = 'compound'; // í˜„ì¬ ì„ íƒëœ ë³´ê³ ì„œ íƒ€ì…
        let pendingReportData = null; // ë¹„ë™ê¸° ë°ì´í„° ìˆ˜ì‹  ëŒ€ê¸°ìš© ë³€ìˆ˜

        // ëª¨ë‹¬ ì—´ê¸°
        // ëª¨ë‹¬ ì—´ê¸°
        function openReportModal(reportType = 'compound') {
            currentReportType = reportType;
            const modal = document.getElementById('reportModal');
            modal.style.display = 'flex';

            // ê¸°ë³¸ê°’ìœ¼ë¡œ í˜„ì¬ ë‚˜ì´ ì„¤ì •
            let currentAge;
            if (reportType === 'compound') {
                currentAge = compState.age;
            } else if (reportType === 'monthly') {
                currentAge = Number(document.getElementById('mc-age').value) || 45;
            } else if (reportType === 'delay') {
                currentAge = Number(document.getElementById('delay-age').value) || 45;
            } else if (reportType === 'retirement') {
                currentAge = Number(document.getElementById('ret-age').value) || 40;
            } else if (reportType === 'lifecycle') {
                currentAge = 30;
            } else if (reportType === 'withdrawal') {
                currentAge = 50;
            }
            document.getElementById('modal-client-age').value = currentAge;
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeReportModal() {
            const modal = document.getElementById('reportModal');
            modal.style.display = 'none';
        }

        // ë³´ê³ ì„œ ìƒì„±
        function generateReport() {
            // ê³ ê° ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const clientName = document.getElementById('modal-client-name').value.trim();
            const clientAge = document.getElementById('modal-client-age').value.trim();
            const purpose = document.getElementById('modal-analysis-purpose').value.trim() || 'ìì‚° ì„±ì¥ ë¶„ì„';

            // í•„ìˆ˜ ì…ë ¥ê°’ ê²€ì¦
            if (!clientName) {
                alert('ê³ ê°ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!clientAge) {
                alert('ë‚˜ì´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë³´ê³ ì„œ íƒ€ì…ë³„ ì²˜ë¦¬
            let params, reportUrl;

            if (currentReportType === 'compound') {
                // ìˆ˜ìµìœ¨ ë¹„êµ ë³´ê³ ì„œ
                if (compState.data.length === 0) {
                    alert('ë¨¼ì € ìˆ˜ìµìœ¨ì„ ê³„ì‚°í•´ì£¼ì„¸ìš”.');
                    return;
                }

                const final = compState.data[compState.data.length - 1];

                params = new URLSearchParams({
                    clientName, clientAge, purpose,
                    principal: compState.principal,
                    duration: compState.duration,
                    age: compState.age,
                    rateA: compState.rateA,
                    rateB: compState.rateB,
                    totalA: final.totalA,
                    totalB: final.totalB,
                    accRateA: final.accRateA,
                    accRateB: final.accRateB,
                    diff: final.diff
                });
                reportUrl = 'report_compound.html';

            } else if (currentReportType === 'monthly') {
                // ë³µë¦¬ì˜ ë§ˆë²• ë³´ê³ ì„œ
                const age = Number(document.getElementById('mc-age').value);
                const save = Number(document.getElementById('mc-save-input').value);
                const rate = Number(document.getElementById('mc-rate').value);
                const years = Number(document.getElementById('mc-years').value);

                // ë³µë¦¬ ê³„ì‚°
                const monthlyRate = rate / 100 / 12;
                const months = years * 12;
                let total = 0;

                for (let m = 0; m < months; m++) {
                    total = (total + save) * (1 + monthlyRate);
                }

                const totalPrincipal = save * months;
                const totalInterest = total - totalPrincipal;
                const yieldRate = (totalInterest / totalPrincipal) * 100;

                params = new URLSearchParams({
                    clientName, clientAge, purpose,
                    monthlySave: save,
                    rate: rate,
                    years: years,
                    age: age,
                    totalPrincipal: totalPrincipal,
                    totalInterest: totalInterest,
                    finalAmount: total,
                    yieldRate: yieldRate
                });
                reportUrl = 'report_monthly.html';

            } else if (currentReportType === 'delay') {
                // ê²Œìœ¼ë¦„ ë¹„ìš© ë³´ê³ ì„œ
                const targetAmount = parseInt(document.getElementById('delay-amount').value) || 0;
                const totalYears = parseInt(document.getElementById('delay-years').value) || 0;
                const delayYears = parseInt(document.getElementById('delay-delay').value) || 0;
                const rate = parseFloat(document.getElementById('delay-rate').value) || 0;

                const nowMonthly = parseMoney(document.getElementById('delay-now-monthly').textContent);
                const nowTotal = parseMoney(document.getElementById('delay-now-total').textContent);
                const delayMonthly = parseMoney(document.getElementById('delay-delay-monthly').textContent);
                const delayTotal = parseMoney(document.getElementById('delay-delay-total').textContent);
                const delayCost = parseMoney(document.getElementById('delay-cost').textContent);

                params = new URLSearchParams({
                    clientName, clientAge, purpose,
                    targetAmount, totalYears, delayYears, rate,
                    nowMonthly, nowTotal, delayMonthly, delayTotal, delayCost
                });
                reportUrl = 'report_delay.html';

            } else if (currentReportType === 'retirement') {
                // í™©ê¸ˆ ê±°ìœ„ ë³´ê³ ì„œ
                const retireAge = parseInt(document.getElementById('ret-retire-age').value) || 65;
                const monthlyPension = parseInt(document.getElementById('ret-pension').value) || 0;
                const targetAmount = parseMoney(document.getElementById('ret-target').textContent);

                const saveYears = parseInt(document.getElementById('ret-save-years').value) || 10;
                const saveRate = parseFloat(document.getElementById('ret-save-rate').value) || 5;

                const deferYears = parseInt(document.getElementById('ret-defer-years').value) || 15;
                const deferRate = parseFloat(document.getElementById('ret-defer-rate').value) || 5;

                const monthlySave = parseMoney(document.getElementById('ret-monthly').textContent);
                const stage1Amount = parseMoney(document.getElementById('ret-fv-save').textContent);
                const stage2Amount = parseMoney(document.getElementById('ret-target-2').textContent);

                params = new URLSearchParams({
                    clientName, clientAge, purpose,
                    retireAge, monthlyPension, targetAmount,
                    saveYears, saveRate,
                    deferYears, deferRate,
                    monthlySave, stage1Amount, stage2Amount
                });
                reportUrl = 'report_retirement.html';

            } else if (currentReportType === 'lifecycle') {
                pendingReportData = { clientName, clientAge, purpose };
                const iframe = document.getElementById('iframe-lifecycle');
                if (iframe && iframe.contentWindow) {
                    iframe.contentWindow.postMessage('requestReportData', '*');
                }
                return;

            } else if (currentReportType === 'withdrawal') {
                pendingReportData = { clientName, clientAge, purpose };
                const iframe = document.getElementById('iframe-withdrawal');
                if (iframe && iframe.contentWindow) {
                    iframe.contentWindow.postMessage('requestReportData', '*');
                }
                return;
            }

            // ìƒˆ ì°½ì—ì„œ ë³´ê³ ì„œ ì—´ê¸°
            window.open(`${reportUrl}?${params.toString()}`, '_blank', 'width=1024,height=768');

            // ëª¨ë‹¬ ë‹«ê¸°
            closeReportModal();
        }

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('reportModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeReportModal();
            }
        });

    </script>
    <script>
        // ë©”ì‹œì§€ ìˆ˜ì‹  í•¸ë“¤ëŸ¬ (iframe ë°ì´í„° ìˆ˜ì‹ )
        window.addEventListener('message', function (event) {
            if (!pendingReportData) return;

            if (event.data.type === 'lifecycleResponse') {
                const { clientName, clientAge, purpose } = pendingReportData;
                const { currentAge, goals, totalAmount } = event.data;

                const goalsStr = encodeURIComponent(JSON.stringify(goals));

                const params = new URLSearchParams({
                    clientName, clientAge, purpose,
                    currentAge, totalAmount,
                    goals: goalsStr
                });

                window.open(`report_lifecycle.html?${params.toString()}`, '_blank', 'width=1024,height=768');
                closeReportModal();
                pendingReportData = null;

            } else if (event.data.type === 'withdrawalResponse') {
                const { clientName, clientAge, purpose } = pendingReportData;
                const { currentAge, funds, summaryNominal, summaryPV } = event.data;

                const fundsStr = encodeURIComponent(JSON.stringify(funds));

                const params = new URLSearchParams({
                    clientName, clientAge, purpose,
                    currentAge, summaryNominal, summaryPV,
                    funds: fundsStr
                });

                window.open(`report_withdrawal.html?${params.toString()}`, '_blank', 'width=1024,height=768');
                closeReportModal();
                pendingReportData = null;
            }
        });
    </script>
</body>

</html>